00001A9E Starting Address
Assembler used: EASy68K Editor/Assembler v5.16.01
Created On: 05/01/2020 15:20:59

00000000                             1  ; =============================================================================   
00000000                             2  ; TITLE    : KABOOM GAME
00000000                             3  ; AUTHOR   :
00000000                             4  ; CREATION :
00000000                             5  ; =============================================================================
00000000                             6  
00001000                             7              ORG     $1000
00001000                             8  
00001000                             9  ; --- CODE INCLUDES -----------------------------------------------------------
00001000                            10  
00001000                            11              INCLUDE "SYSCONST.X68"          ; SYSTEM CONSTANTS
00001000                            12  ; =============================================================================
00001000                            13  ; SYSTEM CONSTANTS
00001000                            14  ; =============================================================================
00001000                            15  
00001000                            16  ; --- TRAP RELATED CONSTANTS --------------------------------------------------
00001000                            17  
00001000  =00000000                 18  KBDTRAP     EQU     0                       ; KEYBOARD UPDATE TRAP
00001000  =00000001                 19  SCRTRAP     EQU     1                       ; SCREEN REFRESH TRAP
00001000                            20  
00001000                            21  ; --- KEY CODES (EASy68K)
00001000                            22  
00001000  =00000020                 23  KBDCHRSP    EQU     $20                     ; SPACE KEY
00001000  =0000004D                 24  KBDCHRMK    EQU     'M'                     ; M KEY
00001000  =00000010                 25  KBDCHRSH    EQU     $10                     ; SHIFT KEY
00001000  =00000050                 26  KBDCHRPK    EQU     'P'                     ; P KEY
00001000  =00000025                 27  KBDCHRLF    EQU     $25                     ; LEFT KEY
00001000  =00000026                 28  KBDCHRUP    EQU     $26                     ; UP KEY
00001000  =00000027                 29  KBDCHRRT    EQU     $27                     ; RIGHT KEY
00001000  =00000028                 30  KBDCHRDN    EQU     $28                     ; DOWN KEY
00001000                            31  
00001000                            32  ; --- KEYBOARD MAPPING --------------------------------------------------------
00001000                            33  
00001000  =00000025                 34  KBDLEFT     EQU     KBDCHRLF                ; LEFT BUTTON
00001000  =00000026                 35  KBDUP       EQU     KBDCHRUP                ; UP BUTTON
00001000  =00000027                 36  KBDRIGHT    EQU     KBDCHRRT                ; RIGHT BUTTON
00001000  =00000028                 37  KBDDOWN     EQU     KBDCHRDN                ; DOWN BUTTON
00001000  =00000020                 38  KBDFIRE1    EQU     KBDCHRSP                ; FIRE 1 BUTTON
00001000  =0000004D                 39  KBDFIRE2    EQU     KBDCHRMK                ; FIRE 2 BUTTON
00001000  =00000010                 40  KBDFIRE3    EQU     KBDCHRSH                ; FIRE 3 BUTTON
00001000  =00000050                 41  KBDPAUSE    EQU     KBDCHRPK                ; PAUSE BUTTON
00001000                            42  
00001000                            43  ; --- KEYBOARD BITFIELD MASKS -------------------------------------------------
00001000                            44  ; CONVENIENCE CONSTANTS TO ACCESS THE FOLLOWING BIT-FIELD.
00001000                            45  ; THIS BIT-FIELD IS USED BY SYSTEM VARS (KBDVAL) AND (KBDEDGE).
00001000                            46  ; +---+---+---+---+---+---+---+---+
00001000                            47  ; | 7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 |
00001000                            48  ; +---+---+---+---+---+---+---+---+
00001000                            49  ;   |   |   |   |   |   |   |   |
00001000                            50  ;   |   |   |   |   |   |   |   +---------- LEFT BUTTON
00001000                            51  ;   |   |   |   |   |   |   +-------------- UP BUTTON
00001000                            52  ;   |   |   |   |   |   +------------------ RIGHT BUTTON
00001000                            53  ;   |   |   |   |   +---------------------- DOWN BUTTON
00001000                            54  ;   |   |   |   +-------------------------- FIRE 1 BUTTON
00001000                            55  ;   |   |   +------------------------------ FIRE 2 BUTTON
00001000                            56  ;   |   +---------------------------------- FIRE 3 BUTTON
00001000                            57  ;   +-------------------------------------- PAUSE BUTTON
00001000                            58  
00001000  =00000001                 59  KBDMSKLF    EQU     %00000001
00001000  =00000002                 60  KBDMSKUP    EQU     %00000010
00001000  =00000004                 61  KBDMSKRT    EQU     %00000100
00001000  =00000008                 62  KBDMSKDN    EQU     %00001000
00001000  =00000010                 63  KBDMSKF1    EQU     %00010000
00001000  =00000020                 64  KBDMSKF2    EQU     %00100000
00001000  =00000040                 65  KBDMSKF3    EQU     %01000000
00001000  =00000080                 66  KBDMSKPS    EQU     %10000000
00001000                            67  
00001000                            68  ; --- KEYBOARD BITFIELD POSITIONS ---------------------------------------------
00001000                            69  
00001000  =00000000                 70  KBDBITLF    EQU     0
00001000  =00000001                 71  KBDBITUP    EQU     1
00001000  =00000002                 72  KBDBITRT    EQU     2
00001000  =00000003                 73  KBDBITDN    EQU     3
00001000  =00000004                 74  KBDBITF1    EQU     4
00001000  =00000005                 75  KBDBITF2    EQU     5
00001000  =00000006                 76  KBDBITF3    EQU     6
00001000  =00000007                 77  KBDBITPS    EQU     7
00001000                            78  
00001000                            79  ; --- SCREEN RELATED CONSTANTS ------------------------------------------------
00001000                            80  
00001000  =00000280                 81  SCRWIDTH    EQU     640                     ; SCREEN WIDTH (PIXELS)
00001000  =000001E0                 82  SCRHEIGH    EQU     480                     ; SCREEN HEIGHT (PIXELS)
00001000  =00000001                 83  SCRIRQ      EQU     1                       ; SCREEN INTERRUPT NUMBER
00001000  =00000014                 84  SCRTIM      EQU     20                      ; SCREEN TIMER (MS)
00001000                            85  
00001000                            86  ; --- DYNAMIC MEMORY CONSTANTS ------------------------------------------------
00001000                            87  
00001000  =00000040                 88  DMMBSIZE    EQU     64                      ; BLOCK SIZE (BYTES). POWER OF TWO
00001000  =00000032                 89  DMMBNUM     EQU     50                      ; NUMBER OF BLOCKS
00001000  =00000000                 90  DMMSYSID    EQU     0                       ; SYSTEM OWNER ID (MUST BE 0)
00001000  =00000000                 91  -------------------- end include --------------------
00001000                            92              INCLUDE "SYSTEM.X68"            ; SYSTEM CODE
00001000                            93  ; =============================================================================
00001000                            94  ; SYSTEM MANAGEMENT (SYSTEM CODE)
00001000                            95  ; =============================================================================
00001000                            96  ;Francisco José Muñoz Navarro 43480416c
00001000                            97  ;Joan Alcover Lladó 45187596w
00001000                            98  ;Francesc Nova Prieto 43483419x
00001000                            99  ; -----------------------------------------------------------------------------
00001000                           100  SYSINIT
00001000                           101              
00001000                           102  ; INITIALIZES THE SYSTEM
00001000                           103  ; INPUT    - NONE
00001000                           104  ; OUTPUT   - NONE
00001000                           105  ; MODIFIES - NONE
00001000                           106  ; -----------------------------------------------------------------------------
00001000  205F                     107              MOVE.L  (A7)+,A0                ; GET RETURN ADDRESS
00001002  4EB9 000010A6            108              JSR     KBDINIT                 ; INIT KEYBOARD
00001008  4EB9 0000101C            109              JSR     SCRINIT                 ; INIT SCREEN
0000100E  4EB9 00001176            110              JSR     DMMINIT                 ; INIT DYNAMIC MEMORY
00001014  027C DFFF                111              ANDI.W  #$DFFF,SR               ; SWITCH TO USER
00001018  2F08                     112              MOVE.L  A0,-(A7)                ; PUT RETURN ADDRESS
0000101A  4E75                     113              RTS
0000101C                           114  
0000101C                           115  ; =============================================================================
0000101C                           116  ; SCREEN MANAGEMENT (SYSTEM CODE)
0000101C                           117  ; =============================================================================
0000101C                           118  
0000101C                           119  ; -----------------------------------------------------------------------------
0000101C                           120  SCRINIT
0000101C                           121  ; INITIALIZES THE SCREEN, SCREEN-RELATED INTERRUPT AND VARS.
0000101C                           122  ; INPUT    - NONE
0000101C                           123  ; OUTPUT   - NONE
0000101C                           124  ; MODIFIES - WHATEVER IS REQUIRED, NO NEED TO RESTORE REGISTERS.
0000101C                           125  ; -----------------------------------------------------------------------------
0000101C                           126              ; TO DO:
0000101C                           127              
0000101C                           128              ; - DISABLE INTS (SET INT BITS IN SR TO 111)
0000101C  007C 0700                129              ORI.W #$0700,SR
00001020                           130              
00001020                           131              ; - INSTALL SCRUPD INTO TRAP SCRTRAP
00001020  21FC 0000108C 0084       132              MOVE.L #SCRUPD,($80+SCRTRAP*4)
00001028                           133              
00001028                           134              ; - SET RESOLUTION TO SCRWIDTH X SCRHEIGHT
00001028  103C 0021                135              MOVE.B #33,D0
0000102C  223C 028001E0            136              MOVE.L #SCRWIDTH<<16|SCRHEIGH,D1
00001032  4E4F                     137              TRAP #15
00001034                           138              
00001034                           139              ; - SET WINDOWED MODE
00001034  7201                     140              MOVE.L #1,D1
00001036  4E4F                     141              TRAP #15     
00001038                           142        
00001038                           143              ; - CLEAR VISIBLE BUFFER
00001038  323C FF00                144              MOVE.W #$FF00,D1
0000103C  103C 000B                145              MOVE.B #11,D0
00001040  4E4F                     146              TRAP #15
00001042                           147  
00001042                           148  
00001042                           149              ; - ENABLE DOUBLE BUFFER
00001042  705C                     150              MOVE.L #92,D0
00001044  7211                     151              MOVE.L #17,D1
00001046  4E4F                     152              TRAP #15
00001048                           153              
00001048                           154              ; - CLEAR HIDDEN BUFFER           
00001048  323C FF00                155              MOVE.W #$FF00,D1
0000104C  103C 000B                156              MOVE.B #11,D0
00001050  4E4F                     157              TRAP #15    
00001052                           158              
00001052                           159              
00001052                           160              ; - INSTALL SCRISR FOR IRQ SCRIRQ (IRQ INTERRUPT VECTOR BEGINS
00001052                           161              ;   AT $60. INSTALLATION IS SIMILAR TO TRAP INSTALLATION)
00001052  21FC 0000107E 0064       162              MOVE.L #SCRISR,($60+SCRIRQ*4)
0000105A                           163              
0000105A                           164              
0000105A                           165              ; - ENABLE AUTO-IRQ EVERY SCRTIM MS FOR IRQ SCRIRQ (SEE TRAP #15
0000105A                           166              ;   TASK 32)
0000105A                           167              
0000105A  123C 0006                168              MOVE.B #6,D1
0000105E  103C 0020                169              MOVE.B #32,D0
00001062  7401                     170              MOVE.L #SCRIRQ,D2
00001064  843C 0080                171              OR.B #$80,D2
00001068  7614                     172              MOVE.L #SCRTIM,D3
0000106A                           173              
0000106A  4E4F                     174              TRAP #15
0000106C                           175              
0000106C                           176              ; - CLEAR SCRINTCT AND SCRCYCCT
0000106C  4239 00001ACC            177              CLR.B SCRINTCT
00001072  4239 00001ACD            178              CLR.B SCRCYCCT
00001078                           179              ; - ENABLE INTS (SET INT BITS IN SR TO 000)
00001078  027C F8FF                180              ANDI.W #$F8FF,SR
0000107C                           181              
0000107C  4E75                     182              RTS
0000107E                           183  
0000107E                           184  ; -----------------------------------------------------------------------------
0000107E                           185  SCRISR
0000107E                           186  ; SCREEN TIMER ISR. INCREASES THE INTERRUPT COUNTER AND UPDATES DOUBLE BUFFER.
0000107E                           187  ; INPUT    - NONE
0000107E                           188  ; OUTPUT   - NONE
0000107E                           189  ; MODIFIES - NONE
0000107E                           190  ; -----------------------------------------------------------------------------
0000107E  5239 00001ACC            191              ADDQ.B  #1,(SCRINTCT)           ; UPDATE INT FLAG/COUNTER
00001084  5239 00001ACD            192              ADDQ.B  #1,(SCRCYCCT)           ; UPDATE CYCLE COUNTER
0000108A  4E73                     193              RTE
0000108C                           194  
0000108C                           195  ; -----------------------------------------------------------------------------
0000108C                           196  SCRUPD
0000108C                           197  ; TRAP SERVICE ROUTINE IN CHARGE OF VISUALIZING CURRENT FRAME AND CLEARING
0000108C                           198  ; BUFFER FOR THE NEXT ONE.
0000108C                           199  ; INPUT    - NONE
0000108C                           200  ; OUTPUT   - NONE
0000108C                           201  ; MODIFIES - NONE
0000108C                           202  ; -----------------------------------------------------------------------------
0000108C                           203              ; TO DO: UPDATE DOUBLE BUFFER AND CLEAR HIDDEN BUFFER
0000108C  48E7 C000                204              MOVEM.L D0-D1,-(A7)
00001090  103C 005E                205              MOVE.B #94,D0
00001094  4E4F                     206              TRAP #15
00001096  323C FF00                207              MOVE.W #$FF00,D1
0000109A  103C 000B                208              MOVE.B #11,D0
0000109E  4E4F                     209              TRAP #15 
000010A0  4CDF 0003                210              MOVEM.L (A7)+,D0-D1 
000010A4  4E73                     211              RTE
000010A6                           212  
000010A6                           213  ; =============================================================================
000010A6                           214  ; KEYBOARD MANAGEMENT (SYSTEM CODE)
000010A6                           215  ; =============================================================================
000010A6                           216  
000010A6                           217  ; -----------------------------------------------------------------------------
000010A6                           218  KBDINIT
000010A6                           219  ; INITIALIZES THE SYSTEM VARIABLES KBDSYS AND KBDVAL
000010A6                           220  ; INPUT    - NONE
000010A6                           221  ; OUTPUT   - NONE
000010A6                           222  ; MODIFIES - NONE
000010A6                           223  ; -----------------------------------------------------------------------------
000010A6  4239 00001ACA            224              CLR.B   (KBDVAL)                ; INIT VARS
000010AC  4239 00001ACB            225              CLR.B   (KBDEDGE)
000010B2  21FC 000010BC 0080       226              MOVE.L  #KBDREAD,($80+KBDTRAP*4) ; INSTALL
000010BA  4E75                     227              RTS
000010BC                           228  
000010BC                           229  ; -----------------------------------------------------------------------------
000010BC                           230  KBDREAD
000010BC                           231  ; TRAP SERVICE ROUTINE.
000010BC                           232  ; UPDATES THE SYSTEM VARIABLES KBDEDGE AND KBDVAL ACCORDING TO THE BITFIELD
000010BC                           233  ; DESCRIBED IN SYSCONST. KBDVAL HOLDS THE CURRENT VALUES AND KBDEFGE HOLDS
000010BC                           234  ; RISING EDGES FROM PREVIOUS CALL TO THE CURRENT ONE.
000010BC                           235  ; INPUT    - NONE
000010BC                           236  ; OUTPUT   - (KBDVAL) AND (KBDEDGE)
000010BC                           237  ; MODIFIES - NONE
000010BC                           238  ; -----------------------------------------------------------------------------
000010BC                           239              ; TO DO: UPDATE KBDVAL AND KBDEDGE
000010BC                           240              
000010BC                           241              ;PARA GUARDAR EL ESTADO DE LAS TECLAS LAS CUATRO PRIMERAS EN D1 
000010BC                           242              ;Y LAS CUATRO SIGUIENTES EN D2
000010BC  48E7 E000                243              MOVEM.L D0-D2,-(A7)
000010C0  103C 0013                244              MOVE.B #19,D0
000010C4  223C 25262728            245              MOVE.L #KBDLEFT<<24+KBDUP<<16+KBDRIGHT<<8+KBDDOWN,D1
000010CA  4E4F                     246              TRAP #15
000010CC  2401                     247              MOVE.L  D1,D2
000010CE  223C 204D1050            248              MOVE.L #KBDFIRE1<<24+KBDFIRE2<<16+KBDFIRE3<<8+KBDPAUSE,D1
000010D4  4E4F                     249              TRAP #15
000010D6                           250              ;---------
000010D6                           251              ;---------
000010D6                           252              ;GUARDAMOS EL ANTIGUO VALOR DE KBDVAL PARA USARLO POSTERIORMENT          
000010D6  1039 00001ACA            253              MOVE.B KBDVAL,D0
000010DC                           254              
000010DC                           255              ;INICIALIZAMOS KBDVAL
000010DC  4239 00001ACA            256              CLR.B KBDVAL 
000010E2                           257              ;MIRAMOS CADA UNA DE LAS TECLAS SI HAN SIDO PULSADAS O NO
000010E2                           258              ;SALTAS A LA SIGUIENTE ETIQUETA SI HA SIDO PULSADA
000010E2  0802 0018                259              BTST.L #24,D2
000010E6  6700 000A                260              BEQ  .UP
000010EA  0039 0001 00001ACA       261              ORI.B #KBDMSKLF,KBDVAL 
000010F2                           262              
000010F2  0802 0010                263  .UP         BTST.L #16,D2
000010F6  6700 000A                264              BEQ  .RIGHT
000010FA  0039 0002 00001ACA       265              ORI.B #KBDMSKUP,KBDVAL 
00001102                           266  
00001102  0802 0008                267  .RIGHT      BTST.L #8,D2       
00001106  6700 000A                268              BEQ  .DOWN
0000110A  0039 0004 00001ACA       269              ORI.B #KBDMSKRT,KBDVAL 
00001112                           270              
00001112  0802 0000                271  .DOWN       BTST.L #0,D2       
00001116  6700 000A                272              BEQ  .FIRE1
0000111A  0039 0008 00001ACA       273              ORI.B #KBDMSKDN,KBDVAL  
00001122                           274              
00001122  0801 0018                275  .FIRE1      BTST.L #24,D1       
00001126  6700 000A                276              BEQ  .FIRE2
0000112A  0039 0010 00001ACA       277              ORI.B #KBDMSKF1,KBDVAL   
00001132                           278              
00001132  0801 0010                279  .FIRE2      BTST.L #16,D1       
00001136  6700 000A                280              BEQ  .FIRE3
0000113A  0039 0020 00001ACA       281              ORI.B #KBDMSKF2,KBDVAL  
00001142                           282              
00001142  0801 0008                283  .FIRE3      BTST.L #8,D1       
00001146  6700 000A                284              BEQ  .PAUSE
0000114A  0039 0040 00001ACA       285              ORI.B #KBDMSKF3,KBDVAL 
00001152                           286              
00001152  0801 0000                287  .PAUSE      BTST.L #0,D1       
00001156  6700 000A                288              BEQ  .FIN
0000115A  0039 0080 00001ACA       289              ORI.B #KBDMSKPS,KBDVAL 
00001162                           290              
00001162                           291  .FIN       ;PARA SABER EL NUEVO VALOR DE KBDEDGE ECESITAMOS COMPARAR 
00001162                           292             ;EL ATIGUO VALOR DE KBDVAL CON EL NUEVO 
00001162                           293             ;EL VALOR DE KBDEDGE ESTARA EN D0
00001162  4600                     294              NOT.B   D0
00001164  C039 00001ACA            295              AND.B   KBDVAL ,D0
0000116A  13C0 00001ACB            296              MOVE.B  D0,KBDEDGE 
00001170                           297              
00001170                           298              
00001170  4CDF 0007                299              MOVEM.L (A7)+,D0-D2         
00001174  4E73                     300              RTE
00001176                           301  
00001176                           302  ; =============================================================================
00001176                           303  ; DYNAMIC MEMORY MANAGEMENT (SYSTEM CODE)
00001176                           304  ; DYNAMIC MEMORY IS A SET OF DMMBNUM SLOTS OF DMMBSIZE BYTES EACH ONE.
00001176                           305  ; DMMBSIZE MUST BE POWER OF TWO. A SLOT HAS:
00001176                           306  ; - HEADER - 1 WORD. SPECIFIES THE OWNER (0 MEANS OWNED BY SYSTEM)
00001176                           307  ; - DATA   - DMMBSIZE - 2 BYTES. MAY CONTAIN VARS AND ANY KIND OF DATA RELATED
00001176                           308  ;            THE THE OWNER. IF OWNER==0, DATA IS MEANINGLESS.
00001176                           309  ; =============================================================================
00001176                           310  
00001176                           311  ; -----------------------------------------------------------------------------
00001176                           312  DMMINIT
00001176                           313  ; INITIALIZES THE DYNAMIC MEMORY TO ALL OWNED BY SYSTEM.
00001176                           314  ; INPUT    - NONE
00001176                           315  ; OUTPUT   - NONE
00001176                           316  ; MODIFIES - NONE
00001176                           317  ; -----------------------------------------------------------------------------
00001176  48E7 8080                318              MOVEM.L D0/A0,-(A7)
0000117A  41F9 00001B00            319              LEA     DMMDATA,A0
00001180  303C 0031                320              MOVE.W  #DMMBNUM-1,D0
00001184  30BC 0000                321  .LOOP       MOVE.W  #DMMSYSID,(A0)
00001188  D1FC 00000040            322              ADD.L   #DMMBSIZE,A0
0000118E  51C8 FFF4                323              DBRA.W  D0,.LOOP
00001192  4CDF 0101                324              MOVEM.L (A7)+,D0/A0
00001196  4E75                     325              RTS
00001198                           326  
00001198                           327  ; -----------------------------------------------------------------------------
00001198                           328  DMMFIRST
00001198                           329  ; SEARCHES THE FIRST MEMORY SLOT NOT OWNED BY SYSTEM AND OUTPUTS A POINTER
00001198                           330  ; TO THE CORRESPONDING DATA (SLOT ADDRESS+2)
00001198                           331  ; INPUT    - NONE
00001198                           332  ; OUTPUT   - A0   : POINTER TO THE DATA OR 0 IF NOT FOUND
00001198                           333  ; MODIFIES - NONE (ASIDE OF OUTPUT)
00001198                           334  ; -----------------------------------------------------------------------------
00001198  41F9 00001B00            335              LEA     DMMDATA,A0
0000119E  4A58                     336  DMMFRLOP    TST.W   (A0)+
000011A0  6600 0016                337              BNE     DMMFRFND
000011A4  D1FC 0000003E            338              ADD.L   #DMMBSIZE-2,A0
000011AA  B1FC 0000277F            339  DMMFRCOM    CMP.L   #DMMDATA+DMMBSIZE*DMMBNUM-1,A0
000011B0  6DEC                     340              BLT     DMMFRLOP
000011B2  207C 00000000            341              MOVE.L  #0,A0
000011B8  4E75                     342  DMMFRFND    RTS
000011BA                           343  
000011BA                           344  ; -----------------------------------------------------------------------------
000011BA                           345  DMMNEXT
000011BA                           346  ; SEARCHES THE NEXT MEMORY SLOT NOT OWNED BY SYSTEM AND OUTPUTS A POINTER
000011BA                           347  ; TO THE CORRESPONDING DATA (SLOT ADDRESS+2)
000011BA                           348  ; INPUT    - A0   : POINTER WITHIN THE CURRENT SLOT
000011BA                           349  ; OUTPUT   - A0   : POINTER TO THE DATA OR 0 IF NOT FOUND
000011BA                           350  ; MODIFIES - NONE (ASIDE OF OUTPUT)
000011BA                           351  ; -----------------------------------------------------------------------------
000011BA  2F00                     352              MOVE.L  D0,-(A7)
000011BC  2008                     353              MOVE.L  A0,D0
000011BE  C0BC FFFFFFC0            354              AND.L   #-DMMBSIZE,D0           ; TAKE ADVANTAGE OF ALIGNMENT
000011C4  0680 00000040            355              ADD.L   #DMMBSIZE,D0
000011CA  2040                     356              MOVE.L  D0,A0
000011CC  201F                     357              MOVE.L  (A7)+,D0
000011CE  60DA                     358              BRA     DMMFRCOM
000011D0                           359  
000011D0                           360  ; -----------------------------------------------------------------------------
000011D0                           361  DMMFRSTO
000011D0                           362  ; SEARCHES THE FIRST MEMORY SLOT WITH THE SPECIFIED ID AND OUTPUTS A POINTER
000011D0                           363  ; TO THE CORRESPONDING DATA (SLOT ADDRESS+2)
000011D0                           364  ; INPUT    - D0.W : ID TO SEARCH
000011D0                           365  ; OUTPUT   - A0   : POINTER TO THE DATA OR 0 IF NOT FOUND
000011D0                           366  ; MODIFIES - NONE (ASIDE OF OUTPUT)
000011D0                           367  ; -----------------------------------------------------------------------------
000011D0  41F9 00001B00            368              LEA     DMMDATA,A0
000011D6  B058                     369  DMMFLOOP    CMP.W   (A0)+,D0
000011D8  6700 0016                370              BEQ     DMMFFND
000011DC  D1FC 0000003E            371              ADD.L   #DMMBSIZE-2,A0
000011E2  B1FC 0000277F            372  DMMFCOM     CMP.L   #DMMDATA+DMMBSIZE*DMMBNUM-1,A0
000011E8  6DEC                     373              BLT     DMMFLOOP
000011EA  207C 00000000            374              MOVE.L  #0,A0
000011F0  4E75                     375  DMMFFND     RTS
000011F2                           376  
000011F2                           377  ; -----------------------------------------------------------------------------
000011F2                           378  DMMNEXTO
000011F2                           379  ; SEARCHES THE NEXT MEMORY SLOT WITH THE SPECIFIED ID AND OUTPUTS A POINTER
000011F2                           380  ; TO THE CORRESPONDING DATA (SLOT ADDRESS+2)
000011F2                           381  ; INPUT    - D0.W : ID TO SEARCH
000011F2                           382  ;            A0   : POINTER WITHIN THE CURRENT SLOT
000011F2                           383  ; OUTPUT   - A0   : POINTER TO THE DATA OR 0 IF NOT FOUND
000011F2                           384  ; MODIFIES - NONE (ASIDE OF OUTPUT)
000011F2                           385  ; -----------------------------------------------------------------------------
000011F2  2F00                     386              MOVE.L  D0,-(A7)
000011F4  2008                     387              MOVE.L  A0,D0
000011F6  C0BC FFFFFFC0            388              AND.L   #-DMMBSIZE,D0           ; TAKE ADVANTAGE OF ALIGNMENT
000011FC  0680 00000040            389              ADD.L   #DMMBSIZE,D0
00001202  2040                     390              MOVE.L  D0,A0
00001204  201F                     391              MOVE.L  (A7)+,D0
00001206  60DA                     392              BRA     DMMFCOM
00001208                           393  
00001208                           394  ; -----------------------------------------------------------------------------
00001208                           395  DMMALLOC
00001208                           396  ; SEARCHES THE FIRST FREE (SYS OWNED) SLOT, ASSIGNS TO THE SPECIFIED OWNER
00001208                           397  ; AND RETURNS A POINTER TO THE CORRESPONDING DATA (SLOT ADDRESS + 2)
00001208                           398  ; INPUT    - D0.W : ID TO ASSIGN
00001208                           399  ; OUTPUT   - A0   : POINTER TO THE DATA OR 0 IF NOT FREE SPACE
00001208                           400  ; MODIFIES - NONE (ASIDE OF OUTPUT)
00001208                           401  ; -----------------------------------------------------------------------------
00001208  3F00                     402              MOVE.W  D0,-(A7)
0000120A  4240                     403              CLR.W   D0
0000120C  4EB8 11D0                404              JSR     DMMFRSTO
00001210  301F                     405              MOVE.W  (A7)+,D0
00001212  B1FC 00000000            406              CMP.L   #0,A0
00001218  6700 0006                407              BEQ     .END
0000121C  3140 FFFE                408              MOVE.W  D0,-2(A0)
00001220  4E75                     409  .END        RTS
00001222                           410  
00001222                           411  ; -----------------------------------------------------------------------------
00001222                           412  DMMFREE
00001222                           413  ; FREES THE SLOT TO WHICH THE PROVIDED POINTER BELONGS BY SETTING ITS OWNED TO
00001222                           414  ; SYSTEM (0)
00001222                           415  ; INPUT    - A0   : POINTER BELONGING TO THE SLOT TO FREE
00001222                           416  ; OUTPUT   - NONE
00001222                           417  ; MODIFIES - NONE
00001222                           418  ; -----------------------------------------------------------------------------
00001222  48E7 8080                419              MOVEM.L D0/A0,-(A7)
00001226  2008                     420              MOVE.L  A0,D0
00001228  C0BC FFFFFFC0            421              AND.L   #-DMMBSIZE,D0           ; TAKE ADVANTAGE OF ALIGNMENT
0000122E  2040                     422              MOVE.L  D0,A0
00001230  4250                     423              CLR.W   (A0)
00001232  4CDF 0101                424              MOVEM.L (A7)+,D0/A0
00001236  4E75                     425              RTS
00001238                           426  
00001238                           427  
00001238                           428  
00001238                           429  
00001238                           430  
00001238                           431  
00001238                           432  
00001238                           433  
00001238                           434  
00001238                           435  
00001238                           436  
00001238                           437  
00001238                           438  
00001238                           439  
00001238                           440  
00001238                           441  
00001238                           442  
00001238                           443  
00001238                           444  
00001238                           445  
00001238                           446  
00001238                           447  
00001238                           448  
00001238                           449  
00001238                           450  
00001238                           451  
00001238                           452  
00001238                           453  
00001238                           454  
00001238                           455  
00001238                           456  
00001238                           457  
00001238                           458  
00001238                           459  
00001238                           460  
00001238                           461  
00001238                           462  -------------------- end include --------------------
00001238                           463              INCLUDE "CONST.X68"             ; USER CONSTANTS
00001238                           464  ; =============================================================================
00001238                           465  ; SYSTEM CONSTANTS
00001238                           466  ; =============================================================================
00001238                           467  
00001238                           468  ; --- GAME STATES -------------------------------------------------------------
00001238                           469  
00001238  =FFFFFFFF                470  STANONE     EQU     -1                      ; PLACEHOLDER TO FORCE CHANGE
00001238  =00000000                471  STAINTR     EQU     0                       ; INTRO/PRESS FIRE STATE
00001238  =00000001                472  STAPLAY     EQU     1                       ; NORMAL GAME STATE
00001238  =00000002                473  STAGOVR     EQU     2                       ; GAME OVER STATE
00001238                           474  
00001238                           475  ; --- AGENT TYPES -------------------------------------------------------------
00001238                           476  
00001238  =00000001                477  SHTTYPE     EQU     1
00001238  =00000002                478  ASTTYPE     EQU     2
00001238  =00000003                479  XPLTYPE     EQU     3
00001238                           480  
00001238                           481  ; --- PLAYER RELATED CONSTANTS ------------------------------------------------
00001238                           482  
00001238  =00000064                483  PLRWIDTH    EQU     100                    ; PLAYER WIDTH (PIXELS)
00001238  =00000028                484  PLRHEIGH    EQU     40                    ; PLAYER HEIGHT (PIXELS)
00001238  =000001F4                485  PLRINIEN    EQU     500                     ; PLAYER INITIAL ENERGY (<SCRWIDTH)
00001238  =0000000A                486  PLRSPEED    EQU     10                       ; PLAYER SPEED (PIXELS PER INT)
00001238  =0000C0FF                487  PLRNRMCL    EQU     $0000C0FF               ; PLAYER NORMAL COLOR
00001238  =000000FF                488  PLRDMGCL    EQU     $000000FF               ; PLAYER DAMAGED COLOR
00001238  =00FFFFFF                489  PLRTXTCL    EQU     $00FFFFFF               ; FONT COLOR
00001238  =00000002                490  PLRTXTX     EQU     2                       ; SCORE X COORDINATE
00001238  =00000001                491  PLRTXTY     EQU     1                       ; SCORE Y COORDINATE
00001238  =00000014                492  PLRLIFEH    EQU     20                      ; HEIGHT OF LIFE BAR
00001238  =000001B8                493  PLRLIFEY    EQU     SCRHEIGH-PLRLIFEH*2     ; LIFE BAR Y POS
00001238  =000000FF                494  PLRLIFEC    EQU     $000000FF               ; LIFE BAR COLOR
00001238  =00000001                495  PLRUMDMG    EQU     %00000001               ; UPDATE DAMAGE MASK
00001238  =00000002                496  PLRPMDMG    EQU     %00000010               ; PLOT DAMAGE MASK
00001238  =00000000                497  PLRUBDMG    EQU     0                       ; UPDATE DAMAGE BIT
00001238  =00000001                498  PLRPBDMG    EQU     1                       ; PLOT DAMAGE BIT
00001238                           499  
00001238  =00000003                500  PLRCLIFE     EQU     3                      ; PLAYER CONSTANT LIFE 
00001238                           501  
00001238                           502  ; --- SHOT RELATED CONSTANTS --------------------------------------------------
00001238                           503  
00001238  =00000014                504  SHTWIDTH    EQU     20                      ; SHOT WIDTH (PIXELS)
00001238  =00000003                505  SHTHEIGH    EQU     3                       ; SHOT HEIGHT. ONLY TO DRAW.
00001238  =0000000A                506  SHTSPEED    EQU     10                      ; SHOT SPEED (PIXELS PER INT)
00001238                           507  
00001238                           508  ; --- ASTEROID RELATED CONSTANTS ----------------------------------------------
00001238                           509  
00001238  =00000014                510  BOMBSIZE     EQU     20                      ; ASTEROID DIAMETER
00001238  =00FFFFFF                511  BOMBPENCL    EQU     $00FFFFFF               ; ASTEROID PEN COLOR
00001238  =0000FF00                512  BOMBFILCL    EQU     $0000FF00               ; ASTEROID FIL COLOR
00001238  =00000001                513  BOMBDMG      EQU     1                       ; ASTEROID DAMAGE TO PLAYER
00001238  =00000005                514  BOMBFRAG     EQU     5                       ; NUMBER OF FRAGMENTS IN EXPLOSION
00001238  =00000005                515  BOMBSCORE    EQU     5                       ; SCORE ASTEROID DESTRUCTION
00001238                           516  
00001238                           517  ; --- EXPLOSION RELATED CONSTANTS ---------------------------------------------
00001238                           518  
00001238  =00000014                519  XPLSIZE     EQU     20                      ; EXPLOSION ITEM DIAMETER (PIXELS)
00001238  =00DDDDDD                520  XPLPENCL    EQU     $00DDDDDD               ; EXPLOSION ITEM PEN COLOR
00001238  =00CCCCCC                521  XPLFILCL    EQU     $00CCCCCC               ; EXPLOSION ITEM FIL COLOR
00001238                           522  
00001238                           523  ; --- INTRO STATE RELATED CONSTANTS -------------------------------------------
00001238                           524  
00001238  =0000001F                525  INTTITX     EQU     31                      ; TITLE X COORDINATE
00001238  =00000005                526  INTTITY     EQU     5                       ; TITLE Y COORDINATE
00001238  =000000FF                527  INTTITC     EQU     $000000FF               ; TITLE COLOR
00001238  =0000001F                528  INTPRSX     EQU     31                      ; PRESS FIRE X COORDINATE
00001238  =0000001A                529  INTPRSY     EQU     26                      ; PRESS FIRE Y COORDINATE
00001238  =00FFFFFF                530  INTPRSC     EQU     $00FFFFFF               ; PRESS FIRE COLOR
00001238                           531  
00001238                           532  ; --- PAUSED STATE RELATED CONSTANTS -------------------------------------------
00001238                           533  
00001238  =00000019                534  PAUSTITX     EQU     25                      ; TITLE X COORDINATE
00001238  =0000000F                535  PAUSTITY     EQU     15                       ; TITLE Y COORDINATE
00001238                           536  
00001238                           537  
00001238                           538  ; --- GAME OVER STATE RELATED CONSTANTS ---------------------------------------
00001238                           539  
00001238  =00000023                540  GOVSTRX     EQU     35                      ; TITLE X COORDINATE
00001238  =0000000F                541  GOVSTRY     EQU     15                      ; TITLE Y COORDINATE
00001238  =00FFFFFF                542  GOVSTRC     EQU     $00FFFFFF               ; TITLE COLOR
00001238                           543  
00001238                           544  ; --- BOMBMAN RELATED CONSTANTS ------------------------------------------------
00001238                           545  
00001238  =0000001E                546  BMNWIDTH   EQU     30                      ;BOMBMAN WIDTH  (PIXELS)
00001238  =0000001E                547  BMNHEIGH   EQU     30                      ;BOMBMAN HEIGHT (PIXELS)
00001238  =00000009                548  BMNSPEED   EQU     9                       ;BOMBMAN SPEED (PIXELS PER INT)
00001238  =0051AE00                549  BMNNRMCL   EQU     $0051AE00               ;BOMBMAN NORMAL COLOR
00001238                           550  
00001238                           551  
00001238                           552  
00001238                           553  
00001238                           554  
00001238                           555  
00001238                           556  
00001238                           557  
00001238                           558  
00001238                           559  
00001238                           560  
00001238                           561  
00001238                           562  
00001238                           563  
00001238                           564  
00001238                           565  -------------------- end include --------------------
00001238                           566              INCLUDE "UTIL.X68"              ; UTILITY MACRO AND SUBROUTINES
00001238                           567  ; =============================================================================
00001238                           568  ; UTILITY MACROS
00001238                           569  ; =============================================================================
00001238                           570  
00001238                           571  ; -----------------------------------------------------------------------------
00001238                           572  UTLSPEN     MACRO
00001238                           573  ; WRAPPER FOR SET PEN TRAP 15 TASK.
00001238                           574  ; INPUT    - \1 COLOR IN FORMAT $00BBGGRR
00001238                           575  ; OUTPUT   - NONE
00001238                           576  ; MODIFIES - D0,D1
00001238                           577  ; -----------------------------------------------------------------------------
00001238                           578              MOVE.B  #80,D0
00001238                           579              MOVE.L  \1,D1
00001238                           580              TRAP    #15
00001238                           581              ENDM
00001238                           582  
00001238                           583  ; -----------------------------------------------------------------------------
00001238                           584  UTLSFIL     MACRO
00001238                           585  ; WRAPPER FOR SET FIL TRAP 15 TASK.
00001238                           586  ; INPUT    - \1 COLOR IN FORMAT $00BBGGRR
00001238                           587  ; OUTPUT   - NONE
00001238                           588  ; MODIFIES - D0,D1
00001238                           589  ; -----------------------------------------------------------------------------
00001238                           590              MOVE.B  #81,D0
00001238                           591              MOVE.L  \1,D1
00001238                           592              TRAP    #15
00001238                           593              ENDM
00001238                           594  
00001238                           595  ; -----------------------------------------------------------------------------
00001238                           596  UTLLOCT     MACRO
00001238                           597  ; WRAPPER TO TEXT POSITIONNING FROM TRAP 15
00001238                           598  ; INPUT    - \1 X, \2 Y
00001238                           599  ; OUTPUT   - NONE
00001238                           600  ; MODIFIES - D0,D1
00001238                           601  ; -----------------------------------------------------------------------------
00001238                           602              MOVE.W  #\1<<8|\2, D1
00001238                           603              MOVE.B  #11,D0
00001238                           604              TRAP    #15
00001238                           605              ENDM
00001238                           606  
00001238                           607  UTLSND     MACRO
00001238                           608  ; WRAPPER FOR PLAYING WAV FILE TRAP 15 TASK
00001238                           609  ; INPUT    - \1 ADDRESS TO STRING WITH NAME OF THE FILE
00001238                           610  ; OUTPUT   - D0.W=0 IF SOUND NOT PLAYED, NON ZERO IF PLAYED
00001238                           611  ; MODIFIES - D0,A1
00001238                           612  ; -----------------------------------------------------------------------------
00001238                           613              LEA     \1, A1             ;PLAY EXPLOSION SOUND
00001238                           614              MOVE.L  #73,D0
00001238                           615              TRAP    #15
00001238                           616              ENDM
00001238                           617  ; =============================================================================
00001238                           618  ; UTILITY SUBROUTINES
00001238                           619  ; =============================================================================
00001238                           620  
00001238                           621  ; -----------------------------------------------------------------------------
00001238                           622  UTLINIT
00001238                           623  ; INITIALIZES UTILITY CODE
00001238                           624  ; INPUT    - NONE
00001238                           625  ; OUTPUT   - NONE
00001238                           626  ; MODIFIES - NONE
00001238                           627  ; -----------------------------------------------------------------------------
00001238  4239 000027C2            628              CLR.B   (UTLRNDIX)
0000123E  4E75                     629              RTS
00001240                           630  ; -----------------------------------------------------------------------------
00001240                           631  UTLCHCOL
00001240                           632  ; CHECKS COLLISION
00001240                           633  ; INPUT    - D0.W X0 COORDINATE
00001240                           634  ;            D1.W Y0 COORDINATE
00001240                           635  ;            D2.W X1 COORDINATE
00001240                           636  ;            D3.W Y1 COORDINATE
00001240                           637  ;            D4.W WIDTH 0
00001240                           638  ;            D5.W WIDTH 1
00001240                           639  ;            D6.W HEIGHT 0
00001240                           640  ;            D7.W HEIGHT 1
00001240                           641  ; OUTPUT   - D0.B=FF - COLLISION, =0 - NO COLLISION
00001240                           642  ; MODIFIES - NONE
00001240                           643  ; -----------------------------------------------------------------------------
00001240  48A7 0F00                644              MOVEM.W D4-D7,-(A7)
00001244  D840                     645              ADD.W   D0,D4
00001246  B842                     646              CMP.W   D2,D4
00001248  6F00 0022                647              BLE     .NOCOL
0000124C  DA42                     648              ADD.W   D2,D5
0000124E  BA40                     649              CMP.W   D0,D5
00001250  6F00 001A                650              BLE     .NOCOL
00001254  DC41                     651              ADD.W   D1,D6
00001256  BC43                     652              CMP.W   D3,D6
00001258  6F00 0012                653              BLE     .NOCOL
0000125C  DE43                     654              ADD.W   D3,D7
0000125E  BE41                     655              CMP.W   D1,D7
00001260  6F00 000A                656              BLE     .NOCOL
00001264  103C 00FF                657              MOVE.B  #$FF,D0
00001268  6000 0004                658              BRA     .END
0000126C  4200                     659  .NOCOL      CLR.B   D0
0000126E  4C9F 00F0                660  .END        MOVEM.W (A7)+,D4-D7
00001272  4E75                     661              RTS
00001274                           662  
00001274                           663  ; -----------------------------------------------------------------------------
00001274                           664  UTLRAND
00001274                           665  ; PROVIDES A PSEUDO-RANDOM BYTE
00001274                           666  ; INPUT    - NONE
00001274                           667  ; OUTPUT   - D0.L RANDOM VALUE (ONLY BYTE)
00001274                           668  ; MODIFIES - NONE (ASIDE OF OUTPUT)
00001274                           669  ; -----------------------------------------------------------------------------
00001274  2F08                     670              MOVE.L  A0,-(A7)
00001276  41F9 00001292            671              LEA     .RANDVEC,A0
0000127C  4280                     672              CLR.L   D0
0000127E  1039 000027C2            673              MOVE.B  (UTLRNDIX),D0
00001284  1030 0800                674              MOVE.B  (A0,D0.L),D0
00001288  5239 000027C2            675              ADDQ.B  #1,(UTLRNDIX)
0000128E  205F                     676              MOVE.L  (A7)+,A0
00001290  4E75                     677              RTS
00001292                           678  
00001292                           679  
00001292= C0 EE 9A 0C F5 24 ...    680  .RANDVEC    DC.B    192, 238, 154, 12 , 245, 36 , 32 , 103
0000129A= 2A A3 51 26 E0 AC ...    681              DC.B    42 , 163, 81 , 38 , 224, 172, 19 , 69
000012A2= 75 51 CA FD 33 EB ...    682              DC.B    117, 81 , 202, 253, 51 , 235, 108, 154
000012AA= 60 CC E7 B8 9A EB ...    683              DC.B    96 , 204, 231, 184, 154, 235, 34 , 203
000012B2= 1D 76 B5 95 B0 89 ...    684              DC.B    29 , 118, 181, 149, 176, 137, 62 , 108
000012BA= 39 15 48 C9 6E CA ...    685              DC.B    57 , 21 , 72 , 201, 110, 202, 159, 41
000012C2= 43 E7 E2 7C 37 25 ...    686              DC.B    67 , 231, 226, 124, 55 , 37 , 84 , 62
000012CA= E9 94 CE E9 E4 52 ...    687              DC.B    233, 148, 206, 233, 228, 82 , 243, 78
000012D2= 37 6D 9A 84 A2 28 ...    688              DC.B    55 , 109, 154, 132, 162, 40 , 30 , 39
000012DA= 19 E2 C6 77 80 D4 ...    689              DC.B    25 , 226, 198, 119, 128, 212, 232, 225
000012E2= 0A 5A 32 67 33 C2 ...    690              DC.B    10 , 90 , 50 , 103, 51 , 194, 222, 40
000012EA= 59 80 DC 0E 57 FC ...    691              DC.B    89 , 128, 220, 14 , 87 , 252, 243, 252
000012F2= 8A AB BC F7 07 4D ...    692              DC.B    138, 171, 188, 247, 7  , 77 , 29 , 234
000012FA= EF D5 77 6E 1E BB ...    693              DC.B    239, 213, 119, 110, 30 , 187, 131, 23
00001302= D6 E0 2A 8F BD 28 ...    694              DC.B    214, 224, 42 , 143, 189, 40 , 212, 130
0000130A= 13 4F 66 EC 0A 64 ...    695              DC.B    19 , 79 , 102, 236, 10 , 100, 122, 188
00001312= 56 52 9A 16 9B 90 ...    696              DC.B    86 , 82 , 154, 22 , 155, 144, 7  , 199
0000131A= 06 8A A4 F7 01 DA ...    697              DC.B    6  , 138, 164, 247, 1  , 218, 166, 82
00001322= F2 E7 77 28 B1 76 ...    698              DC.B    242, 231, 119, 40 , 177, 118, 220, 102
0000132A= A4 42 E3 81 B1 67 ...    699              DC.B    164, 66 , 227, 129, 177, 103, 165, 108
00001332= BF CE FA 16 BF 38 ...    700              DC.B    191, 206, 250, 22 , 191, 56 , 30 , 161
0000133A= D1 8B 50 0C 5F 49 ...    701              DC.B    209, 139, 80 , 12 , 95 , 73 , 168, 56
00001342= DE 4C 14 A2 40 DC ...    702              DC.B    222, 76 , 20 , 162, 64 , 220, 93 , 12
0000134A= B6 9B 0A 38 5D AB ...    703              DC.B    182, 155, 10 , 56 , 93 , 171, 89 , 6
00001352= E2 1B DD 75 15 82 ...    704              DC.B    226, 27 , 221, 117, 21 , 130, 101, 18
0000135A= 8A 26 51 30 9F 47 ...    705              DC.B    138, 38 , 81 , 48 , 159, 71 , 57 , 21
00001362= 1E 8A BB 71 C6 6E ...    706              DC.B    30 , 138, 187, 113, 198, 110, 185, 152
0000136A= 9F 47 E5 34 94 27 ...    707              DC.B    159, 71 , 229, 52 , 148, 39 , 77 , 6
00001372= 7D 06 D6 BA 30 0F ...    708              DC.B    125, 6  , 214, 186, 48 , 15 , 212, 22
0000137A= EC 7F 7E 03 CF 2D ...    709              DC.B    236, 127, 126, 3  , 207, 45 , 193, 2
00001382= 94 5B 23 F2 8B CD ...    710              DC.B    148, 91 , 35 , 242, 139, 205, 248, 237
0000138A= 74 33 EC B9 0F D5 ...    711              DC.B    116, 51 , 236, 185, 15 , 213, 221, 6
00001392                           712  
00001392                           713  
00001392                           714  
00001392                           715  
00001392                           716  -------------------- end include --------------------
00001392                           717              INCLUDE "PLAYER.X68"            ; PLAYER MANAGEMENT
00001392                           718  ; =============================================================================
00001392                           719  ; PLAYER MANAGEMENT
00001392                           720  ; =============================================================================
00001392                           721  
00001392                           722  ; -----------------------------------------------------------------------------
00001392                           723  PLRINIT
00001392                           724  ; INITIALIZES THE PLAYER
00001392                           725  ; INPUT    - NONE
00001392                           726  ; OUTPUT   - NONE
00001392                           727  ; MODIFIES - NONE
00001392                           728  ; -----------------------------------------------------------------------------
00001392  33FC 0140 000027B0       729              MOVE.W  #SCRWIDTH/2,(PLRPOSX)
0000139A  33FC 019F 000027B2       730              MOVE.W  #(SCRHEIGH-PLRHEIGH)-25,(PLRPOSY)
000013A2  33FC 0003 000027B8       731              MOVE.W  #3,PLRLIFE 
000013AA  4279 000027B6            732              CLR.W   (PLRSCORE)
000013B0  4E75                     733              RTS
000013B2                           734  
000013B2                           735  ; -----------------------------------------------------------------------------
000013B2                           736  PLRUPD
000013B2                           737  ; UPDATES THE PLAYER MOTION
000013B2                           738  ; INPUT    - NONE (ACCESSES KBDVAL AND KBDEDGE)
000013B2                           739  ; OUTPUT   - NONE (MODIFIES PLAYER DATA)
000013B2                           740  ; MODIFIES - NONE
000013B2                           741  ; -----------------------------------------------------------------------------
000013B2  3F01                     742  .NODMG      MOVE.W  D1,-(A7)
000013B4  1239 00001ACA            743              MOVE.B  (KBDVAL),D1             ; PERFORM MOTION AND CHECK BOUNDS.
000013BA  E219                     744              ROR.B   #1,D1
000013BC  6400 001A                745              BCC     .CHKRT
000013C0  0479 000A 000027B0       746              SUB.W   #PLRSPEED,(PLRPOSX)
000013C8  4A79 000027B0            747              TST.W   (PLRPOSX)
000013CE  6C00 0008                748              BGE     .CHKRT
000013D2  4279 000027B0            749              CLR.W   (PLRPOSX)
000013D8  E419                     750  .CHKRT      ROR.B   #2,D1
000013DA  6400 001E                751              BCC     .NOFIRE
000013DE  0679 000A 000027B0       752              ADD.W   #PLRSPEED,(PLRPOSX)
000013E6  0C79 021C 000027B0       753              CMP.W   #SCRWIDTH-PLRWIDTH,(PLRPOSX)
000013EE  6F00 000A                754              BLE     .NOFIRE
000013F2  33FC 021C 000027B0       755              MOVE.W  #SCRWIDTH-PLRWIDTH,(PLRPOSX)
000013FA  321F                     756  .NOFIRE     MOVE.W  (A7)+,D1
000013FC  4E75                     757              RTS
000013FE                           758  
000013FE                           759  ; -----------------------------------------------------------------------------
000013FE                           760  PLRPLOT
000013FE                           761  ; PLOTS THE PLAYER ITS LIFE AND THE SCORE
000013FE                           762  ; INPUT    - NONE
000013FE                           763  ; OUTPUT   - NONE
000013FE                           764  ; MODIFIES - NONE
000013FE                           765  ; -----------------------------------------------------------------------------
000013FE  48E7 FF00                766              MOVEM.L D0-D7,-(A7)
00001402  223C 0000C0FF            767              MOVE.L  #PLRNRMCL,D1            ; DECIDE COLOR
00001408  08B9 0001 000027BA       768              BCLR.B  #PLRPBDMG,(PLRDMG)
00001410  6700 0008                769              BEQ     .NODMG
00001414  223C 000000FF            770              MOVE.L  #PLRDMGCL,D1
0000141A  103C 0050                771  .NODMG      MOVE.B  #80,D0
0000141E  4E4F                     772              TRAP    #15
00001420  5200                     773              ADDQ.B  #1,D0
00001422  4E4F                     774              TRAP    #15
00001424                           775              
00001424  3239 000027B0            776              MOVE.W  (PLRPOSX),D1            ; PLOT THE PLAYER
0000142A  3439 000027B2            777              MOVE.W  (PLRPOSY),D2
00001430                           778              
00001430  3601                     779              MOVE.W  D1,D3
00001432  3802                     780              MOVE.W  D2,D4
00001434  0643 0064                781              ADD.W   #PLRWIDTH,D3
00001438  0644 0028                782              ADD.W   #PLRHEIGH,D4
0000143C  103C 0057                783              MOVE.B  #87,D0
00001440  4E4F                     784              TRAP    #15
00001442                           785  
00001442                           786m             UTLSPEN #PLRTXTCL               ; PLOT THE SCORE TEXT
00001442                           787m ; WRAPPER FOR SET PEN TRAP 15 TASK.
00001442                           788m ; INPUT    - #PLRTXTCL COLOR IN FORMAT $00BBGGRR
00001442                           789m ; OUTPUT   - NONE
00001442                           790m ; MODIFIES - D0,D1
00001442                           791m ; -----------------------------------------------------------------------------
0000144E                           792m             UTLSFIL #$00000000
0000144E                           793m ; WRAPPER FOR SET FIL TRAP 15 TASK.
0000144E                           794m ; INPUT    - #$00000000 COLOR IN FORMAT $00BBGGRR
0000144E                           795m ; OUTPUT   - NONE
0000144E                           796m ; MODIFIES - D0,D1
0000144E                           797m ; -----------------------------------------------------------------------------
00001456                           798m             UTLLOCT PLRTXTX,PLRTXTY
00001456                           799m ; WRAPPER TO TEXT POSITIONNING FROM TRAP 15
00001456                           800m ; INPUT    - PLRTXTX X, PLRTXTY Y
00001456                           801m ; OUTPUT   - NONE
00001456                           802m ; MODIFIES - D0,D1
00001456                           803m ; -----------------------------------------------------------------------------
00001460  43F9 0000152A            804              LEA     .SCORESTR,A1
00001466  4281                     805              CLR.L   D1
00001468  3239 000027B6            806              MOVE.W  (PLRSCORE),D1
0000146E  103C 0011                807              MOVE.B  #17,D0
00001472  4E4F                     808              TRAP    #15
00001474  3A39 000027B8            809              MOVE.W PLRLIFE,D5
0000147A  5345                     810              SUBQ.W #1,D5
0000147C                           811              
0000147C  3C3C 0208                812              MOVE.W  #520,D6
00001480  3E3C 0212                813              MOVE.W  #530,D7
00001484                           814              
00001484                           815m .HEART      UTLSPEN #$000000FF              ;PLOT THE HEARTS
00001484                           816m ; WRAPPER FOR SET PEN TRAP 15 TASK.
00001484                           817m ; INPUT    - #$000000FF COLOR IN FORMAT $00BBGGRR
00001484                           818m ; OUTPUT   - NONE
00001484                           819m ; MODIFIES - D0,D1
00001484                           820m ; -----------------------------------------------------------------------------
00001490                           821m             UTLSFIL #$000000FF
00001490                           822m ; WRAPPER FOR SET FIL TRAP 15 TASK.
00001490                           823m ; INPUT    - #$000000FF COLOR IN FORMAT $00BBGGRR
00001490                           824m ; OUTPUT   - NONE
00001490                           825m ; MODIFIES - D0,D1
00001490                           826m ; -----------------------------------------------------------------------------
0000149C                           827              ; FIRST LINE OF SQUARE
0000149C  2207                     828              MOVE.L  D7,D1
0000149E  740F                     829              MOVE.L  #15,D2
000014A0  0687 0000000A            830              ADD.L   #10,D7
000014A6  2607                     831              MOVE.L  D7,D3
000014A8  0487 0000000A            832              SUB.L   #10,D7
000014AE  7819                     833              MOVE.L  #25,D4
000014B0  103C 0054                834              MOVE.B  #84,D0
000014B4  4E4F                     835              TRAP    #15
000014B6                           836              
000014B6                           837              ; SECOND LINE OF SQUARE
000014B6  2207                     838              MOVE.L  D7,D1
000014B8  7423                     839              MOVE.L  #35,D2
000014BA  103C 0055                840              MOVE.B  #85,D0
000014BE  4E4F                     841              TRAP    #15
000014C0                           842              
000014C0                           843              ;THIRD LINE OF SQUARE
000014C0  2206                     844              MOVE.L  D6,D1
000014C2  7419                     845              MOVE.L  #25,D2
000014C4  103C 0055                846              MOVE.B  #85,D0
000014C8  4E4F                     847              TRAP    #15
000014CA                           848              
000014CA                           849              ; FOURTH LINE OF SQUARE
000014CA  2207                     850              MOVE.L  D7,D1
000014CC  740F                     851              MOVE.L  #15,D2
000014CE  103C 0055                852              MOVE.B  #85,D0
000014D2  4E4F                     853              TRAP    #15
000014D4                           854              
000014D4                           855              ; LEFT CIRCLE
000014D4  0487 0000000C            856              SUB.L  #12,D7
000014DA  2207                     857              MOVE.L  D7,D1
000014DC  740D                     858              MOVE.L  #13,D2
000014DE  0687 0000000E            859              ADD.L  #14,D7
000014E4  2607                     860              MOVE.L  D7,D3
000014E6  781B                     861              MOVE.L  #27,D4
000014E8  103C 0058                862              MOVE.B  #88,D0
000014EC  4E4F                     863              TRAP    #15
000014EE                           864              
000014EE                           865              ; RIGHT CIRCLE
000014EE  5987                     866              SUB.L  #4,D7
000014F0  2207                     867              MOVE.L  D7,D1
000014F2  740D                     868              MOVE.L  #13,D2
000014F4  0687 0000000E            869              ADD.L  #14,D7
000014FA  2607                     870              MOVE.L  D7,D3
000014FC  781B                     871              MOVE.L  #27,D4
000014FE  103C 0058                872              MOVE.B  #88,D0
00001502  4E4F                     873              TRAP    #15
00001504                           874              
00001504                           875              ; RESTORE D7 VALUE
00001504  0487 0000000C            876              SUB.L   #12,D7
0000150A                           877              
0000150A                           878              ; FILL HEART
0000150A  2207                     879              MOVE.L  D7,D1
0000150C  741E                     880              MOVE.L  #30,D2
0000150E  103C 0059                881              MOVE.B  #89,D0
00001512  4E4F                     882              TRAP    #15
00001514                           883  
00001514  0686 00000028            884              ADD.L   #40,D6
0000151A  0687 00000028            885              ADD.L   #40,D7
00001520  51CD FF62                886              DBRA D5,.HEART
00001524  4CDF 00FF                887              MOVEM.L (A7)+,D0-D7
00001528  4E75                     888              RTS
0000152A= 53 43 4F 52 45 3A ...    889  .SCORESTR   DC.B    'SCORE: ',0
00001532                           890  
00001532                           891  
00001532                           892  
00001532                           893  
00001532                           894  
00001532                           895  
00001532                           896  
00001532                           897  
00001532                           898  
00001532                           899  
00001532                           900  
00001532                           901  
00001532                           902  
00001532                           903  
00001532                           904  
00001532                           905  
00001532                           906  
00001532                           907  
00001532                           908  
00001532                           909  
00001532                           910  
00001532                           911  
00001532                           912  
00001532                           913  -------------------- end include --------------------
00001532                           914              INCLUDE "BOMBMAN.X68"           ; BOMBMAN MANEGEMENT
00001532                           915  ; =============================================================================
00001532                           916  ; BOMBMAN MANAGEMENT
00001532                           917  ; =============================================================================
00001532                           918  
00001532                           919  ; -----------------------------------------------------------------------------
00001532                           920  BMNINIT
00001532                           921  ; INITIALIZES THE BOMBMAN
00001532                           922  ; INPUT    - NONE
00001532                           923  ; OUTPUT   - NONE
00001532                           924  ; MODIFIES - NONE
00001532                           925  ; -----------------------------------------------------------------------------
00001532  33FC 0140 000027BC       926              MOVE.W  #SCRWIDTH/2,(BMNPOSX)
0000153A  33FC 0050 000027BE       927              MOVE.W  #(BMNHEIGH)+50,(BMNPOSY)
00001542  33FC 0081 000027C0       928              MOVE.W  #129,(BMNDIR)
0000154A  4E75                     929              RTS
0000154C                           930  
0000154C                           931  ; -----------------------------------------------------------------------------
0000154C                           932  BMNUPD
0000154C                           933  ; UPDATES THE BOMBMAN MOTION
0000154C                           934  ; INPUT    - NONE 
0000154C                           935  ; OUTPUT   - NONE (MODIFIES BOMBMAN DATA)
0000154C                           936  ; MODIFIES - NONE
0000154C                           937  ; -----------------------------------------------------------------------------
0000154C  1239 00001ACD            938              MOVE.B  (SCRCYCCT),D1
00001552  C27C 0020                939              AND     #$20,D1                 ; EVERY 16 CYCLES
00001556  6600 0024                940              BNE     .ENDCICLE               ; NEW DIRECTION
0000155A  4EB8 1274                941              JSR     UTLRAND
0000155E  3239 000027BC            942              MOVE.W  (BMNPOSX),D1            ;BMNDIR=(BMNPOSX*128)/((SCRWIDTH)/2)
00001564  C2FC 0080                943              MULU.W  #128,D1
00001568  82FC 0140                944              DIVU.W  #320,D1
0000156C  3401                     945              MOVE.W  D1,D2
0000156E  4842                     946              SWAP    D2
00001570  C4FC 0140                947              MULU.W  #320,D2
00001574  D242                     948              ADD.W   D2,D1
00001576  33C1 000027C0            949              MOVE.W  D1,(BMNDIR)             
0000157C                           950  .ENDCICLE                                    
0000157C  B079 000027C0            951              CMP.W   (BMNDIR),D0
00001582  6C00 0020                952              BGE     .CHKRT
00001586  0479 0009 000027BC       953              SUB.W   #BMNSPEED,(BMNPOSX)
0000158E  4A79 000027BC            954              TST.W   (BMNPOSX)
00001594  6C00 002A                955              BGE     .END
00001598  4279 000027BC            956              CLR.W   (BMNPOSX)
0000159E  4EF9 000015C0            957              JMP     .END
000015A4  0679 0009 000027BC       958  .CHKRT      ADD.W   #BMNSPEED,(BMNPOSX)
000015AC  0C79 0262 000027BC       959              CMP     #SCRWIDTH-BMNWIDTH,(BMNPOSX)
000015B4  6F00 000A                960              BLE     .END
000015B8  33FC 0262 000027BC       961              MOVE.W  #SCRWIDTH-BMNWIDTH,(BMNPOSX)
000015C0                           962  .END        
000015C0  4E75                     963              RTS
000015C2                           964  
000015C2                           965  ; -----------------------------------------------------------------------------
000015C2                           966  BMNPLOT
000015C2                           967  ; PLOTS THE BOMBMAN 
000015C2                           968  ; INPUT    - NONE
000015C2                           969  ; OUTPUT   - NONE
000015C2                           970  ; MODIFIES - NONE
000015C2                           971  ; -----------------------------------------------------------------------------
000015C2  48E7 F800                972              MOVEM.L D0-D4,-(A7)
000015C6  223C 0051AE00            973              MOVE.L  #BMNNRMCL,D1            ; DECIDE COLOR
000015CC  103C 0050                974               MOVE.B  #80,D0
000015D0  4E4F                     975              TRAP    #15
000015D2  5200                     976              ADDQ.B  #1,D0
000015D4  4E4F                     977              TRAP    #15            
000015D6  3239 000027BC            978              MOVE.W  (BMNPOSX),D1            ; PLOT THE BOMBMAN
000015DC  3439 000027BE            979              MOVE.W  (BMNPOSY),D2            
000015E2  3601                     980              MOVE.W  D1,D3
000015E4  3802                     981              MOVE.W  D2,D4
000015E6  0643 001E                982              ADD.W   #BMNWIDTH,D3
000015EA  0644 001E                983              ADD.W   #BMNHEIGH,D4
000015EE  103C 0057                984              MOVE.B  #87,D0
000015F2  4E4F                     985              TRAP    #15
000015F4                           986  
000015F4                           987  
000015F4  4CDF 001F                988              MOVEM.L (A7)+,D0-D4
000015F8  4E75                     989              RTS
000015FA                           990  
000015FA                           991  
000015FA                           992  
000015FA                           993  
000015FA                           994  
000015FA                           995  
000015FA                           996  
000015FA                           997  
000015FA                           998  
000015FA                           999  
000015FA                          1000  
000015FA                          1001  
000015FA                          1002  
000015FA                          1003  -------------------- end include --------------------
000015FA                          1004              INCLUDE "AGENTLST.X68"          ; AGENT LIST MANAGEMENT
000015FA                          1005  ; =============================================================================
000015FA                          1006  ; AGENT MANAGEMENT
000015FA                          1007  ; EACH AGENT HAS A DATA BLOCK FROM DMM AS FOLLOWS:
000015FA                          1008  ; +0 - LONG : UPDATE SUBROUTINE POINTER
000015FA                          1009  ; +4 - LONG : PLOT SUBROUTINE POINTER
000015FA                          1010  ; +8:END    : DATA (AGENT SPECIFIC)
000015FA                          1011  ; =============================================================================
000015FA                          1012  
000015FA                          1013  ; -----------------------------------------------------------------------------
000015FA                          1014  AGLADD
000015FA                          1015  ; CREATES A NEW AGENT
000015FA                          1016  ; INPUT    - A1 - POINTER TO AGENT INIT FUNCTION
000015FA                          1017  ;            A2 - POINTER TO AGENT UPDATE FUNCTION
000015FA                          1018  ;            A3 - POINTER TO AGENT PLOT FUNCTION
000015FA                          1019  ;            D0 - AGENT TYPE (USED AS OWNED BY DMM)
000015FA                          1020  ;            D1 - AGENT INITIALIZATION PARAMETER 1
000015FA                          1021  ;            D2 - AGENT INITIALIZATION PARAMETER 2
000015FA                          1022  ;            D3 - AGENT INITIALIZATION PARAMETER 3
000015FA                          1023  ; OUTPUT   - NONE
000015FA                          1024  ; MODIFIES - NONE
000015FA                          1025  ; -----------------------------------------------------------------------------
000015FA  2F08                    1026              MOVE.L  A0,-(A7)
000015FC  4EB8 1208               1027              JSR     DMMALLOC
00001600  B1FC 00000000           1028              CMP.L   #0,A0
00001606  6700 0008               1029              BEQ     .END
0000160A  20CA                    1030              MOVE.L  A2,(A0)+
0000160C  20CB                    1031              MOVE.L  A3,(A0)+
0000160E  4E91                    1032              JSR     (A1)
00001610  205F                    1033  .END        MOVE.L  (A7)+,A0
00001612  4E75                    1034              RTS
00001614                          1035  
00001614                          1036  ; -----------------------------------------------------------------------------
00001614                          1037  AGLUPD
00001614                          1038  ; UPDATES THE AGENT LIST. PRIOR TO CALLING THE UPDATE FUNCTIONS, A0 IS SET
00001614                          1039  ; TO THE DATA BLOCK OF THE CORRESPONDING SLOT.
00001614                          1040  ; INPUT    - NONE
00001614                          1041  ; OUTPUT   - NONE
00001614                          1042  ; MODIFIES - NONE
00001614                          1043  ; -----------------------------------------------------------------------------
00001614  48E7 00C0               1044              MOVEM.L A0-A1,-(A7)
00001618  4EB8 1198               1045              JSR     DMMFIRST
0000161C  B1FC 00000000           1046  .LOOP       CMP.L   #0,A0
00001622  6700 000E               1047              BEQ     .END
00001626  2250                    1048              MOVE.L  (A0),A1
00001628  5088                    1049              ADD.L   #8,A0
0000162A  4E91                    1050              JSR     (A1)
0000162C  4EB8 11BA               1051              JSR     DMMNEXT
00001630  60EA                    1052              BRA     .LOOP
00001632  4CDF 0300               1053  .END        MOVEM.L (A7)+,A0-A1
00001636  4E75                    1054              RTS
00001638                          1055  
00001638                          1056  ; -----------------------------------------------------------------------------
00001638                          1057  AGLPLOT
00001638                          1058  ; PLOTS THE AGENT LIST. PRIOR TO CALLING THE UPDATE FUNCTIONS, A0 IS SET
00001638                          1059  ; TO THE DATA BLOCK OF THE CORRESPONDING SLOT.
00001638                          1060  ; INPUT    - NONE
00001638                          1061  ; OUTPUT   - NONE
00001638                          1062  ; MODIFIES - NONE
00001638                          1063  ; -----------------------------------------------------------------------------
00001638  48E7 00C0               1064              MOVEM.L A0-A1,-(A7)
0000163C  4EB8 1198               1065              JSR     DMMFIRST
00001640  B1FC 00000000           1066  .LOOP       CMP.L   #0,A0
00001646  6700 0010               1067              BEQ     .END
0000164A  2268 0004               1068              MOVE.L  4(A0),A1
0000164E  5088                    1069              ADD.L   #8,A0
00001650  4E91                    1070              JSR     (A1)
00001652  4EB8 11BA               1071              JSR     DMMNEXT
00001656  60E8                    1072              BRA     .LOOP
00001658  4CDF 0300               1073  .END        MOVEM.L (A7)+,A0-A1
0000165C  4E75                    1074              RTS
0000165E                          1075  
0000165E                          1076  ; -----------------------------------------------------------------------------
0000165E  =00001222               1077  AGLKILL     EQU     DMMFREE
0000165E                          1078  ; KILLS THE AGENT BY RELEASING ITS MEMORY
0000165E                          1079  ; INPUT    - A0 POINTER WITHIN THE AGENT MEMORY
0000165E                          1080  ; OUTPUT   - NONE
0000165E                          1081  ; MODIFIES - NONE
0000165E                          1082  ; NOTE     - IT IS JUST A WRAPPER FOR DMMFREE
0000165E                          1083  ; -----------------------------------------------------------------------------
0000165E                          1084  
0000165E                          1085  
0000165E                          1086  -------------------- end include --------------------
0000165E                          1087              INCLUDE "BOMB.X68"              ; BOMB AGENT MANAGEMENT
0000165E                          1088  ; =============================================================================
0000165E                          1089  ; BOMB MANAGEMENT. IT IS AN AGENT.
0000165E                          1090  ; LOCAL MEMORY IS:
0000165E                          1091  ; +0 WORD X COORDINATE
0000165E                          1092  ; +2 WORD Y COORDINATE
0000165E                          1093  ; +4 WORD X SPEED
0000165E                          1094  ; +6 WORD Y SPEED
0000165E                          1095  ; =============================================================================
0000165E                          1096  
0000165E                          1097  ; -----------------------------------------------------------------------------
0000165E                          1098  BOMBINIT
0000165E                          1099  ; INITALIZES A BOMB 
0000165E                          1100  ; INPUT    - A0 POINTER TO THE LOCAL MEMORY
0000165E                          1101  ; OUTPUT   - NONE
0000165E                          1102  ; MODIFIES - NONE
0000165E                          1103  ; NOTE     - ASSUMES SCRHEIGH IS GREATER THAN 255
0000165E                          1104  ; -----------------------------------------------------------------------------
0000165E  48A7 8000               1105              MOVEM.W  D0,-(A7)
00001662  30B9 000027BC           1106              MOVE.W  (BMNPOSX),(A0)         ; X POSITION 
00001668  3039 000027BE           1107              MOVE.W  (BMNPOSY),D0   
0000166E  0640 0014               1108              ADD.W    #BOMBSIZE,D0                 
00001672  3140 0002               1109              MOVE.W   D0,2(A0)              ; Y POSITION           
00001676  317C 0000 0004          1110              MOVE.W   #0,4(A0)              ; X SPEED 
0000167C  317C 0007 0006          1111              MOVE.W   #7,6(A0)              ; Y SPEED 
00001682  4C9F 0001               1112              MOVEM.W  (A7)+,D0
00001686  4E75                    1113              RTS
00001688                          1114  
00001688                          1115  ; -----------------------------------------------------------------------------
00001688                          1116  BOMBUPD
00001688                          1117  ; UPDATES A BOMB 
00001688                          1118  ; INPUT    - A0 POINTER TO THE LOCAL MEMORY
00001688                          1119  ; OUTPUT   - NONE
00001688                          1120  ; MODIFIES - NONE
00001688                          1121  ; -----------------------------------------------------------------------------
00001688  48A7 C000               1122              MOVEM.W  D0-D1,-(A7)
0000168C  3028 0004               1123              MOVE.W  4(A0),D0                ; UPDATE COORDINATES
00001690  9150                    1124              SUB.W   D0,(A0)
00001692  3028 0006               1125              MOVE.W  6(A0),D0
00001696  D168 0002               1126              ADD.W   D0,2(A0)
0000169A  3010                    1127  .COLPLAY    MOVE.W  (A0),D0
0000169C  3228 0002               1128              MOVE.W  2(A0),D1
000016A0  383C 0014               1129              MOVE.W  #BOMBSIZE,D4
000016A4  3C04                    1130              MOVE.W  D4,D6
000016A6  3439 000027B0           1131              MOVE.W  (PLRPOSX),D2
000016AC  3639 000027B2           1132              MOVE.W  (PLRPOSY),D3
000016B2  3A3C 0064               1133              MOVE.W  #PLRWIDTH,D5
000016B6  3E3C 0028               1134              MOVE.W  #PLRHEIGH,D7
000016BA  4EB8 1240               1135              JSR     UTLCHCOL
000016BE  4A00                    1136              TST.B   D0
000016C0  6700 0022               1137              BEQ     .DMG
000016C4  4EB8 1222               1138              JSR     AGLKILL  
000016C8                          1139m             UTLSND .CATCH
000016C8                          1140m ; WRAPPER FOR PLAYING WAV FILE TRAP 15 TASK
000016C8                          1141m ; INPUT    - .CATCH ADDRESS TO STRING WITH NAME OF THE FILE
000016C8                          1142m ; OUTPUT   - D0.W=0 IF SOUND NOT PLAYED, NON ZERO IF PLAYED
000016C8                          1143m ; MODIFIES - D0,A1
000016C8                          1144m ; -----------------------------------------------------------------------------
000016D2  5A79 000027B6           1145              ADD.W   #BOMBSCORE,(PLRSCORE)  
000016D8  4C9F 0003               1146  .END        MOVEM.W  (A7)+,D0-D1
000016DC  4E75                    1147              RTS
000016DE  4EB8 1222               1148  .KILL       JSR     AGLKILL
000016E2  60B6                    1149              BRA     .COLPLAY
000016E4  3028 0002               1150  .DMG        MOVE.W 2(A0),D0
000016E8  3239 000027B2           1151              MOVE.W PLRPOSY,D1
000016EE  0641 0028               1152              ADD.W  #PLRHEIGH,D1
000016F2  B041                    1153              CMP D1,D0
000016F4  6BE2                    1154              BMI .END
000016F6  5379 000027B8           1155              SUB.W #BOMBDMG,PLRLIFE                        
000016FC  4EB8 1222               1156              JSR     AGLKILL            
00001700  60D6                    1157              BRA   .END  
00001702= 534F554E 442F5049 ...   1158  .CATCH      DC.L 'SOUND/PING.WAV',0
00001716                          1159  ; -----------------------------------------------------------------------------
00001716                          1160  BOMBPLOT
00001716                          1161  ; PLOTS A BOMB 
00001716                          1162  ; INPUT    - A0 POINTER TO THE LOCAL MEMORY
00001716                          1163  ; OUTPUT   - NONE
00001716                          1164  ; MODIFIES - NONE
00001716                          1165  ; -----------------------------------------------------------------------------
00001716                          1166m             UTLSPEN #BOMBPENCL
00001716                          1167m ; WRAPPER FOR SET PEN TRAP 15 TASK.
00001716                          1168m ; INPUT    - #BOMBPENCL COLOR IN FORMAT $00BBGGRR
00001716                          1169m ; OUTPUT   - NONE
00001716                          1170m ; MODIFIES - D0,D1
00001716                          1171m ; -----------------------------------------------------------------------------
00001722                          1172m             UTLSFIL #BOMBFILCL
00001722                          1173m ; WRAPPER FOR SET FIL TRAP 15 TASK.
00001722                          1174m ; INPUT    - #BOMBFILCL COLOR IN FORMAT $00BBGGRR
00001722                          1175m ; OUTPUT   - NONE
00001722                          1176m ; MODIFIES - D0,D1
00001722                          1177m ; -----------------------------------------------------------------------------
0000172E  48A7 7800               1178              MOVEM.W D1-D4,-(A7)
00001732  3210                    1179              MOVE.W  (A0),D1
00001734  3428 0002               1180              MOVE.W  2(A0),D2
00001738  3601                    1181              MOVE.W  D1,D3
0000173A  3802                    1182              MOVE.W  D2,D4
0000173C  0643 0014               1183              ADD.W   #BOMBSIZE,D3
00001740  0644 0014               1184              ADD.W   #BOMBSIZE,D4
00001744  103C 0058               1185              MOVE.B  #88,D0
00001748  4E4F                    1186              TRAP    #15
0000174A  4C9F 001E               1187              MOVEM.W (A7)+,D1-D4
0000174E  4E75                    1188              RTS
00001750                          1189  
00001750                          1190  ; -----------------------------------------------------------------------------
00001750                          1191  BOMBXPLO
00001750                          1192  ; EXPLODES A BOMB 
00001750                          1193  ; INPUT    - A0 POINTER TO THE LOCAL MEMORY
00001750                          1194  ; OUTPUT   - NONE
00001750                          1195  ; MODIFIES - NONE
00001750                          1196  ; -----------------------------------------------------------------------------
00001750  48E7 F870               1197              MOVEM.L A1-A3/D0-D4,-(A7)
00001754  383C 0005               1198              MOVE.W  #BOMBFRAG,D4
00001758  43F9 000017BA           1199  .LOOP       LEA     XPLINIT,A1
0000175E  45F9 000017EA           1200              LEA     XPLUPD,A2
00001764  47F9 00001828           1201              LEA     XPLPLOT,A3
0000176A  303C 0003               1202              MOVE.W  #XPLTYPE,D0
0000176E  3210                    1203              MOVE.W  (A0),D1
00001770  0641 000A               1204              ADD.W   #BOMBSIZE/2,D1
00001774  3428 0002               1205              MOVE.W  2(A0),D2
00001778  0642 000A               1206              ADD.W   #BOMBSIZE/2,D2
0000177C  4EB8 15FA               1207              JSR     AGLADD
00001780  51CC FFD6               1208              DBRA.W  D4,.LOOP
00001784  4EB8 1222               1209              JSR     AGLKILL
00001788  4CDF 0E1F               1210              MOVEM.L (A7)+,A1-A3/D0-D4
0000178C  4E75                    1211              RTS
0000178E                          1212  
0000178E                          1213  
0000178E                          1214  
0000178E                          1215  
0000178E                          1216  
0000178E                          1217  
0000178E                          1218  
0000178E                          1219  
0000178E                          1220  
0000178E                          1221  
0000178E                          1222  
0000178E                          1223  -------------------- end include --------------------
0000178E                          1224              INCLUDE "SPAWNER.X68"           ; SPAWNER (CREATES ASTEROIDS)
0000178E                          1225  ; =============================================================================
0000178E                          1226  ; SPAWNER MANAGEMENT.
0000178E                          1227  ; =============================================================================
0000178E                          1228  
0000178E                          1229  ; -----------------------------------------------------------------------------
0000178E                          1230  SPWUPD
0000178E                          1231  ; UPDATES THE SPAWNER
0000178E                          1232  ; INPUT    - NONE
0000178E                          1233  ; OUTPUT   - NONE
0000178E                          1234  ; MODIFIES - NONE
0000178E                          1235  ; -----------------------------------------------------------------------------
0000178E  48E7 8070               1236              MOVEM.L  D0/A1-A3,-(A7)
00001792  1039 00001ACD           1237              MOVE.B  (SCRCYCCT),D0
00001798  C07C 005F               1238              AND     #$5F,D0                 ; EVERY 16 CYCLES
0000179C  6600 0016               1239              BNE     .END                    ; CREATE A NEW ASTEROID
000017A0  43F8 165E               1240              LEA     BOMBINIT,A1
000017A4  45F8 1688               1241              LEA     BOMBUPD,A2
000017A8  47F8 1716               1242              LEA     BOMBPLOT,A3
000017AC  303C 0002               1243              MOVE.W  #ASTTYPE,D0
000017B0  4EB8 15FA               1244              JSR     AGLADD
000017B4  4CDF 0E01               1245  .END        MOVEM.L (A7)+,D0/A1-A3
000017B8  4E75                    1246              RTS
000017BA                          1247  
000017BA                          1248  
000017BA                          1249  
000017BA                          1250  -------------------- end include --------------------
000017BA                          1251              INCLUDE "XPLOSION.X68"          ; EXPLOSION AGENT MANAGEMENT
000017BA                          1252  ; =============================================================================
000017BA                          1253  ; EXPLOSTION MANAGEMENT. IS AN AGENT.
000017BA                          1254  ; LOCAL MEMORY IS:
000017BA                          1255  ; +0 WORD X COORDINATE
000017BA                          1256  ; +2 WORD Y COORDINATE
000017BA                          1257  ; +4 WORD X SPEED
000017BA                          1258  ; +6 WORD Y SPEED
000017BA                          1259  ; =============================================================================
000017BA                          1260  
000017BA                          1261  ; -----------------------------------------------------------------------------
000017BA                          1262  XPLINIT
000017BA                          1263  ; INITALIZES AN EXPLOSION ITEM
000017BA                          1264  ; INPUT    - A0 POINTER TO THE LOCAL MEMORY
000017BA                          1265  ;            D1 X COORDINATE
000017BA                          1266  ;            D2 Y COORDINATE
000017BA                          1267  ; OUTPUT   - NONE
000017BA                          1268  ; MODIFIES - NONE
000017BA                          1269  ; NOTE     - ASSUMES SCRHEIGH IS GREATER THAN 255
000017BA                          1270  ; -----------------------------------------------------------------------------
000017BA  48E7 E000               1271              MOVEM.L D0-D2,-(A7)
000017BE  3081                    1272              MOVE.W  D1,(A0)                 ; SET X POSITION
000017C0  3142 0002               1273              MOVE.W  D2,2(A0)                ; SET Y POSITION
000017C4  4EB8 1274               1274              JSR     UTLRAND                 ; SET RANDOM SPEEDS
000017C8  C07C 001F               1275              AND.W   #$01F,D0
000017CC  0440 000F               1276              SUB.W   #$0F,D0
000017D0  3140 0004               1277              MOVE.W  D0,4(A0)
000017D4  4EB8 1274               1278              JSR     UTLRAND
000017D8  C07C 001F               1279              AND.W   #$01F,D0
000017DC  0440 000F               1280              SUB.W   #$0F,D0
000017E0  3140 0006               1281              MOVE.W  D0,6(A0)
000017E4  4CDF 0007               1282              MOVEM.L (A7)+,D0-D2
000017E8  4E75                    1283              RTS
000017EA                          1284  
000017EA                          1285  ; -----------------------------------------------------------------------------
000017EA                          1286  XPLUPD
000017EA                          1287  ; UPDATES AN EXPLOSION ITEM
000017EA                          1288  ; INPUT    - A0 POINTER TO THE LOCAL MEMORY
000017EA                          1289  ; OUTPUT   - NONE
000017EA                          1290  ; MODIFIES - NONE
000017EA                          1291  ; -----------------------------------------------------------------------------
000017EA  3F00                    1292              MOVE.W  D0,-(A7)
000017EC  3028 0004               1293              MOVE.W  4(A0),D0                ; UPDATE COORDINATES
000017F0  9150                    1294              SUB.W   D0,(A0)
000017F2  3028 0006               1295              MOVE.W  6(A0),D0
000017F6  D168 0002               1296              ADD.W   D0,2(A0)
000017FA  0C50 FFEC               1297              CMP.W   #-XPLSIZE,(A0)
000017FE  6F00 0022               1298              BLE     .KILL
00001802  0C50 0280               1299              CMP.W   #SCRWIDTH,(A0)
00001806  6C00 001A               1300              BGE     .KILL
0000180A  0C68 FFEC 0002          1301              CMP.W   #-XPLSIZE,2(A0)
00001810  6F00 0010               1302              BLE     .KILL
00001814  0C68 01E0 0002          1303              CMP.W   #SCRHEIGH,2(A0)
0000181A  6C00 0006               1304              BGE     .KILL
0000181E  301F                    1305  .END        MOVE.W  (A7)+,D0
00001820  4E75                    1306              RTS
00001822  4EB8 1222               1307  .KILL       JSR   AGLKILL
00001826  60F6                    1308              BRA   .END
00001828                          1309  
00001828                          1310  ; -----------------------------------------------------------------------------
00001828                          1311  XPLPLOT
00001828                          1312  ; PLOTS AN EXPLOSION ITEM
00001828                          1313  ; INPUT    - A0 POINTER TO THE LOCAL MEMORY
00001828                          1314  ; OUTPUT   - NONE
00001828                          1315  ; MODIFIES - NONE
00001828                          1316  ; -----------------------------------------------------------------------------
00001828                          1317m             UTLSPEN #XPLPENCL
00001828                          1318m ; WRAPPER FOR SET PEN TRAP 15 TASK.
00001828                          1319m ; INPUT    - #XPLPENCL COLOR IN FORMAT $00BBGGRR
00001828                          1320m ; OUTPUT   - NONE
00001828                          1321m ; MODIFIES - D0,D1
00001828                          1322m ; -----------------------------------------------------------------------------
00001834                          1323m             UTLSFIL #XPLFILCL
00001834                          1324m ; WRAPPER FOR SET FIL TRAP 15 TASK.
00001834                          1325m ; INPUT    - #XPLFILCL COLOR IN FORMAT $00BBGGRR
00001834                          1326m ; OUTPUT   - NONE
00001834                          1327m ; MODIFIES - D0,D1
00001834                          1328m ; -----------------------------------------------------------------------------
00001840  48A7 7800               1329              MOVEM.W D1-D4,-(A7)
00001844  3210                    1330              MOVE.W  (A0),D1
00001846  3428 0002               1331              MOVE.W  2(A0),D2
0000184A  3601                    1332              MOVE.W  D1,D3
0000184C  3802                    1333              MOVE.W  D2,D4
0000184E  0643 0014               1334              ADD.W   #XPLSIZE,D3
00001852  0644 0014               1335              ADD.W   #XPLSIZE,D4
00001856  103C 0058               1336              MOVE.B  #88,D0
0000185A  4E4F                    1337              TRAP    #15
0000185C  4C9F 001E               1338              MOVEM.W (A7)+,D1-D4
00001860  4E75                    1339              RTS
00001860  4E75                    1340  -------------------- end include --------------------
00001862                          1341              INCLUDE "STATES.X68"            ; GAME STATES MANAGEMENT
00001862                          1342  ; =============================================================================
00001862                          1343  ; GAME STATE MANAGEMENT
00001862                          1344  ; =============================================================================
00001862                          1345  
00001862                          1346  ; -----------------------------------------------------------------------------
00001862                          1347  STAINIT
00001862                          1348  ; INITALIZES THE STATE MANAGER
00001862                          1349  ; INPUT    - NONE
00001862                          1350  ; OUTPUT   - NONE
00001862                          1351  ; MODIFIES - NONE
00001862                          1352  ; -----------------------------------------------------------------------------
00001862  45F9 00002780           1353              LEA.L   STATES,A2
00001868  23EA 0004 000027A8      1354              MOVE.L  1*4(A2),STATE 
00001870  4E75                    1355              RTS
00001872                          1356  ; -----------------------------------------------------------------------------
00001872                          1357  STAMENU
00001872                          1358  ; PERFORMS STATE UPDATE AND INIT IF NECESSARY
00001872                          1359  ; INPUT    - NONE
00001872                          1360  ; OUTPUT   - NONE
00001872                          1361  ; MODIFIES - NONE
00001872                          1362  ; -----------------------------------------------------------------------------          
00001872  47F9 00002798           1363              LEA.L   STATESP,A3
00001878  23D3 000027AC           1364              MOVE.L  (A3),STATEP   
0000187E  0839 0004 00001ACB      1365              BTST.B  #4,KBDEDGE              ; IF "SPACE" IS PRESED
00001886  6700 0010               1366              BEQ     .END
0000188A  45F9 00002780           1367              LEA.L   STATES,A2               ; A0 = STATES LIST
00001890  23EA 0008 000027A8      1368              MOVE.L  2*4(A2),STATE           ; UPDATES NEXT STATE
00001898  4E75                    1369  .END        RTS
0000189A                          1370  ; -----------------------------------------------------------------------------
0000189A                          1371  
0000189A                          1372  ; -----------------------------------------------------------------------------
0000189A                          1373  STAGAME 
0000189A                          1374  ; PERFORMS STATE UPDATE AND INIT IF NECESSARY
0000189A                          1375  ; INPUT    - NONE
0000189A                          1376  ; OUTPUT   - NONE
0000189A                          1377  ; MODIFIES - NONE
0000189A                          1378  ; -----------------------------------------------------------------------------
0000189A  4EB8 1392               1379               JSR PLRINIT
0000189E  4EB8 1532               1380               JSR BMNINIT            
000018A2  45F9 00002780           1381               LEA.L   STATES,A2               ; A0 = STATES LIST
000018A8  23EA 000C 000027A8      1382               MOVE.L  3*4(A2),STATE           ; STATE = STAUPDA
000018B0  4E75                    1383               RTS
000018B2                          1384  
000018B2                          1385  
000018B2                          1386  STAUPD
000018B2                          1387  ; PERFORMS STATE UPDATE AND INIT IF NECESSARY
000018B2                          1388  ; INPUT    - NONE
000018B2                          1389  ; OUTPUT   - NONE
000018B2                          1390  ; MODIFIES - NONE
000018B2                          1391  ; -----------------------------------------------------------------------------
000018B2  47F9 00002798           1392              LEA.L   STATESP,A3
000018B8  23EB 0004 000027AC      1393              MOVE.L  1*4(A3),STATEP           ;UPDATE GAME PLOT
000018C0  4A79 000027B8           1394              TST.W   (PLRLIFE)                      
000018C6  6C00 0016               1395              BGE     .NOTOVER    
000018CA  45F9 00002780           1396              LEA.L    STATES,A2
000018D0  23EA 0014 000027A8      1397              MOVE.L  5*4(A2),STATE
000018D8  4EF9 00001908           1398              JMP     .FIN
000018DE  0839 0007 00001ACB      1399  .NOTOVER    BTST.B  #7,KBDEDGE
000018E6  6700 0010               1400              BEQ     .NEXT
000018EA  45F9 00002780           1401              LEA.L   STATES,A2               ; A0 = STATES LIST
000018F0  23EA 0010 000027A8      1402              MOVE.L  4*4(A2),STATE           ; STATE = STAPAUS  
000018F8  4EB8 154C               1403  .NEXT       JSR     BMNUPD
000018FC  4EB8 13B2               1404              JSR     PLRUPD 
00001900  4EB8 178E               1405              JSR     SPWUPD
00001904  4EB8 1614               1406              JSR     AGLUPD           
00001908  4E75                    1407  .FIN        RTS
0000190A                          1408  
0000190A                          1409  
0000190A                          1410  STAUPDP
0000190A                          1411  ; PERFORMS STATE UPDATE AND INIT IF NECESSARY
0000190A                          1412  ; INPUT    - NONE
0000190A                          1413  ; OUTPUT   - NONE
0000190A                          1414  ; MODIFIES - NONE
0000190A                          1415  ; -----------------------------------------------------------------------------
0000190A  4A79 000027B8           1416              TST.W   (PLRLIFE)                      
00001910  6C00 0010               1417              BGE     .NOTOVER 
00001914  45F9 00002780           1418              LEA.L   STATES,A2
0000191A  23EA 0014 000027A8      1419              MOVE.L  5*4(A2),STATE
00001922  4EB8 13FE               1420  .NOTOVER    JSR     PLRPLOT      
00001926  4EB8 15C2               1421              JSR     BMNPLOT            
0000192A  4EB8 1638               1422              JSR     AGLPLOT    
0000192E  4E75                    1423  .END        RTS
00001930                          1424  ; -----------------------------------------------------------------------------
00001930                          1425  
00001930                          1426  
00001930                          1427  STAPLOT
00001930                          1428  ; PERFORMS STATE PLOT
00001930                          1429  ; INPUT    - NONE
00001930                          1430  ; OUTPUT   - NONE
00001930                          1431  ; MODIFIES - NONE
00001930                          1432  ; -----------------------------------------------------------------------------
00001930  2879 000027AC           1433               MOVE.L     STATEP,A4
00001936  4E94                    1434               JSR        (A4)
00001938  4E75                    1435               RTS
0000193A                          1436  
0000193A                          1437  STAINTRP
0000193A                          1438  ; INTRO STATE PLOT
0000193A                          1439  ; INPUT    - NONE
0000193A                          1440  ; OUTPUT   - NONE
0000193A                          1441  ; MODIFIES - NONE
0000193A                          1442  ; -----------------------------------------------------------------------------
0000193A  48E7 C040               1443              MOVEM.L A1/D0-D1,-(A7)
0000193E                          1444m             UTLLOCT INTTITX,INTTITY
0000193E                          1445m ; WRAPPER TO TEXT POSITIONNING FROM TRAP 15
0000193E                          1446m ; INPUT    - INTTITX X, INTTITY Y
0000193E                          1447m ; OUTPUT   - NONE
0000193E                          1448m ; MODIFIES - D0,D1
0000193E                          1449m ; -----------------------------------------------------------------------------
00001948                          1450m             UTLSPEN #INTTITC
00001948                          1451m ; WRAPPER FOR SET PEN TRAP 15 TASK.
00001948                          1452m ; INPUT    - #INTTITC COLOR IN FORMAT $00BBGGRR
00001948                          1453m ; OUTPUT   - NONE
00001948                          1454m ; MODIFIES - D0,D1
00001948                          1455m ; -----------------------------------------------------------------------------
00001954                          1456m             UTLSFIL #$00000000
00001954                          1457m ; WRAPPER FOR SET FIL TRAP 15 TASK.
00001954                          1458m ; INPUT    - #$00000000 COLOR IN FORMAT $00BBGGRR
00001954                          1459m ; OUTPUT   - NONE
00001954                          1460m ; MODIFIES - D0,D1
00001954                          1461m ; -----------------------------------------------------------------------------
0000195C  43F9 00001998           1462              LEA     .TITSTR,A1
00001962  103C 000E               1463              MOVE.B  #14,D0
00001966  4E4F                    1464              TRAP    #15
00001968                          1465  
00001968                          1466m             UTLLOCT INTPRSX,INTPRSY
00001968                          1467m ; WRAPPER TO TEXT POSITIONNING FROM TRAP 15
00001968                          1468m ; INPUT    - INTPRSX X, INTPRSY Y
00001968                          1469m ; OUTPUT   - NONE
00001968                          1470m ; MODIFIES - D0,D1
00001968                          1471m ; -----------------------------------------------------------------------------
00001972                          1472m             UTLSPEN #INTPRSC
00001972                          1473m ; WRAPPER FOR SET PEN TRAP 15 TASK.
00001972                          1474m ; INPUT    - #INTPRSC COLOR IN FORMAT $00BBGGRR
00001972                          1475m ; OUTPUT   - NONE
00001972                          1476m ; MODIFIES - D0,D1
00001972                          1477m ; -----------------------------------------------------------------------------
0000197E                          1478m             UTLSFIL #$00000000
0000197E                          1479m ; WRAPPER FOR SET FIL TRAP 15 TASK.
0000197E                          1480m ; INPUT    - #$00000000 COLOR IN FORMAT $00BBGGRR
0000197E                          1481m ; OUTPUT   - NONE
0000197E                          1482m ; MODIFIES - D0,D1
0000197E                          1483m ; -----------------------------------------------------------------------------
00001986  43F9 000019A6           1484              LEA     .PRSSTR,A1
0000198C  103C 000E               1485              MOVE.B  #14,D0
00001990  4E4F                    1486              TRAP    #15
00001992  4CDF 0203               1487              MOVEM.L (A7)+,A1/D0-D1
00001996  4E75                    1488              RTS
00001998                          1489  
00001998= 4B 41 42 4F 4F 4D ...   1490  .TITSTR     DC.B    'KABOOM! 68000',0
000019A6= 50 55 53 48 20 46 ...   1491  .PRSSTR     DC.B    'PUSH FIRE TO START',0
000019BA                          1492              DS.W    0
000019BA                          1493  
000019BA                          1494  
000019BA                          1495  ; -----------------------------------------------------------------------------
000019BA                          1496  STAPAUS
000019BA                          1497  ; PERFORMS STATE PAUSED
000019BA                          1498  ; INPUT    - NONE
000019BA                          1499  ; OUTPUT   - NONE
000019BA                          1500  ; MODIFIES - NONE
000019BA                          1501  ; -----------------------------------------------------------------------------
000019BA  47F9 00002798           1502              LEA.L   STATESP,A3               ; A3 = STATES LIST
000019C0  23EB 0008 000027AC      1503              MOVE.L  2*4(A3),STATEP           ; STATEP = STAUPAUSP           
000019C8  0839 0007 00001ACB      1504              BTST.B  #7,KBDEDGE
000019D0  6700 0010               1505              BEQ     .NEXT
000019D4  45F9 00002780           1506              LEA.L   STATES,A2               ; A0 = STATES LIST
000019DA  23EA 000C 000027A8      1507              MOVE.L  3*4(A2),STATE           ; STATE = STAPAUS 
000019E2  4E75                    1508  .NEXT       RTS
000019E4                          1509         
000019E4                          1510  ; -----------------------------------------------------------------------------
000019E4                          1511  
000019E4                          1512  ; -----------------------------------------------------------------------------
000019E4                          1513  STAPAUSP
000019E4                          1514  ; PERFORMS STATE PAUSED
000019E4                          1515  ; INPUT    - NONE
000019E4                          1516  ; OUTPUT   - NONE
000019E4                          1517  ; MODIFIES - NONE
000019E4                          1518  ; -----------------------------------------------------------------------------     
000019E4  4EB8 13FE               1519              JSR     PLRPLOT      
000019E8  4EB8 15C2               1520              JSR     BMNPLOT            
000019EC  4EB8 1638               1521              JSR     AGLPLOT      
000019F0                          1522m             UTLLOCT PAUSTITX,PAUSTITY
000019F0                          1523m ; WRAPPER TO TEXT POSITIONNING FROM TRAP 15
000019F0                          1524m ; INPUT    - PAUSTITX X, PAUSTITY Y
000019F0                          1525m ; OUTPUT   - NONE
000019F0                          1526m ; MODIFIES - D0,D1
000019F0                          1527m ; -----------------------------------------------------------------------------
000019FA                          1528m             UTLSPEN #INTTITC
000019FA                          1529m ; WRAPPER FOR SET PEN TRAP 15 TASK.
000019FA                          1530m ; INPUT    - #INTTITC COLOR IN FORMAT $00BBGGRR
000019FA                          1531m ; OUTPUT   - NONE
000019FA                          1532m ; MODIFIES - D0,D1
000019FA                          1533m ; -----------------------------------------------------------------------------
00001A06                          1534m             UTLSFIL #$00000000
00001A06                          1535m ; WRAPPER FOR SET FIL TRAP 15 TASK.
00001A06                          1536m ; INPUT    - #$00000000 COLOR IN FORMAT $00BBGGRR
00001A06                          1537m ; OUTPUT   - NONE
00001A06                          1538m ; MODIFIES - D0,D1
00001A06                          1539m ; -----------------------------------------------------------------------------
00001A0E  43F9 00001A1C           1540              LEA     .PAUSSTR,A1
00001A14  103C 000E               1541              MOVE.B  #14,D0
00001A18  4E4F                    1542              TRAP    #15
00001A1A  4E75                    1543  .NEXT       RTS
00001A1C                          1544  
00001A1C                          1545  
00001A1C                          1546              
00001A1C= 47 41 4D 45 20 50 ...   1547  .PAUSSTR    DC.B    'GAME PAUSED PUSH "P" TO START',0
00001A3A                          1548  ; -----------------------------------------------------------------------------
00001A3A                          1549  
00001A3A                          1550  ; -----------------------------------------------------------------------------
00001A3A                          1551  STAGOVRU
00001A3A                          1552  ; GAME OVER STATE UPDATE
00001A3A                          1553  ; INPUT    - NONE
00001A3A                          1554  ; OUTPUT   - NONE
00001A3A                          1555  ; MODIFIES - NONE
00001A3A                          1556  ; -----------------------------------------------------------------------------
00001A3A  23EB 000C 000027AC      1557              MOVE.L  3*4(A3),STATEP           ; UPDATES NEXT STATE
00001A42  0839 0004 00001ACB      1558              BTST.B  #4,KBDEDGE
00001A4A  6700 0010               1559              BEQ     .END
00001A4E  45F9 00002780           1560              LEA.L   STATES,A2               ; A0 = STATES LIST
00001A54  23EA 0008 000027A8      1561              MOVE.L  2*4(A2),STATE           ; UPDATES NEXT STATE
00001A5C  4E75                    1562  .END        RTS
00001A5E                          1563  
00001A5E                          1564  ; -----------------------------------------------------------------------------
00001A5E                          1565  STAGOVRP
00001A5E                          1566  ; GAME OVER STATE PLOT
00001A5E                          1567  ; INPUT    - NONE
00001A5E                          1568  ; OUTPUT   - NONE
00001A5E                          1569  ; MODIFIES - NONE
00001A5E                          1570  ; -----------------------------------------------------------------------------           
00001A5E  48E7 C040               1571              MOVEM.L A1/D0-D1,-(A7)
00001A62                          1572m             UTLLOCT GOVSTRX,GOVSTRY
00001A62                          1573m ; WRAPPER TO TEXT POSITIONNING FROM TRAP 15
00001A62                          1574m ; INPUT    - GOVSTRX X, GOVSTRY Y
00001A62                          1575m ; OUTPUT   - NONE
00001A62                          1576m ; MODIFIES - D0,D1
00001A62                          1577m ; -----------------------------------------------------------------------------
00001A6C                          1578m             UTLSPEN #GOVSTRC
00001A6C                          1579m ; WRAPPER FOR SET PEN TRAP 15 TASK.
00001A6C                          1580m ; INPUT    - #GOVSTRC COLOR IN FORMAT $00BBGGRR
00001A6C                          1581m ; OUTPUT   - NONE
00001A6C                          1582m ; MODIFIES - D0,D1
00001A6C                          1583m ; -----------------------------------------------------------------------------
00001A78                          1584m             UTLSFIL #$00000000
00001A78                          1585m ; WRAPPER FOR SET FIL TRAP 15 TASK.
00001A78                          1586m ; INPUT    - #$00000000 COLOR IN FORMAT $00BBGGRR
00001A78                          1587m ; OUTPUT   - NONE
00001A78                          1588m ; MODIFIES - D0,D1
00001A78                          1589m ; -----------------------------------------------------------------------------
00001A80  43F9 00001A92           1590              LEA     .GOVSTR,A1
00001A86  103C 000E               1591              MOVE.B  #14,D0
00001A8A  4E4F                    1592              TRAP    #15
00001A8C  4CDF 0203               1593              MOVEM.L (A7)+,A1/D0-D1
00001A90  4E75                    1594              RTS
00001A92                          1595  
00001A92= 47 41 4D 45 20 20 ...   1596  .GOVSTR     DC.B    'GAME  OVER',0
00001A9E                          1597              DS.W    0
00001A9E                          1598  
00001A9E                          1599  
00001A9E                          1600  
00001A9E                          1601  
00001A9E                          1602  
00001A9E                          1603  
00001A9E                          1604  
00001A9E                          1605  
00001A9E                          1606  
00001A9E                          1607  
00001A9E                          1608  
00001A9E                          1609  
00001A9E                          1610  
00001A9E                          1611  
00001A9E                          1612  
00001A9E                          1613  
00001A9E                          1614  
00001A9E                          1615  
00001A9E                          1616  
00001A9E                          1617  -------------------- end include --------------------
00001A9E                          1618              ; TO DO: PUT YOUR GAME-RELATED INCLUDES HERE
00001A9E                          1619  
00001A9E                          1620  ; --- INITIALIZE --------------------------------------------------------------
00001A9E                          1621  
00001A9E  4EB8 1000               1622  START       JSR     SYSINIT
00001AA2                          1623              ; TO DO: CALL GAME INITIALIZATION CODE HERE
00001AA2  4EB8 1862               1624              JSR     STAINIT                 ; INITIALIZE GAME STATE
00001AA6                          1625              
00001AA6                          1626  
00001AA6                          1627  ; --- UPDATE ------------------------------------------------------------------
00001AA6                          1628  
00001AA6  4E40                    1629  .LOOP       TRAP    #KBDTRAP                ; READ KEYBOARD
00001AA8                          1630              ; TO DO: CALL GAME UPDATE CODE HERE
00001AA8  2479 000027A8           1631              MOVE.L  STATE,A2
00001AAE  4E92                    1632              JSR     (A2)
00001AB0                          1633  
00001AB0                          1634  
00001AB0                          1635  ; --- WAIT SYNCH --------------------------------------------------------------
00001AB0                          1636  
00001AB0  4A39 00001ACC           1637  .WINT       TST.B   (SCRINTCT)              ; WAIT FOR INTERRUPT
00001AB6  67F8                    1638              BEQ     .WINT
00001AB8  4239 00001ACC           1639              CLR.B   (SCRINTCT)
00001ABE                          1640              
00001ABE                          1641              ;para la implementacion de la parte obligatoria del grupo de tres hay que mira en (SCRINTCT) si es 0
00001ABE                          1642              ;si lo es hay que dejarlo como esta sino vamos a otro que reste 1 pero tiene que tener un maximo
00001ABE                          1643  ; --- PLOT --------------------------------------------------------------------
00001ABE                          1644  
00001ABE                          1645              ; TO DO: CALL GAME PLOT CODE HERE
00001ABE  4EB8 1930               1646              JSR      STAPLOT
00001AC2  4E41                    1647              TRAP    #SCRTRAP                ; SHOW GRAPHICS
00001AC4  60E0                    1648              BRA     .LOOP
00001AC6  FFFF FFFF               1649              SIMHALT
00001ACA                          1650  
00001ACA                          1651  ; --- VARIABLES ---------------------------------------------------------------
00001ACA                          1652  
00001ACA                          1653              INCLUDE "SYSVAR.X68"
00001ACA                          1654  ; =============================================================================
00001ACA                          1655  ; SYSTEM VARS
00001ACA                          1656  ; NOTE THAT ALL THESE VARS ARE USED TO SHARE DATA FROM SYSTEM TO USER. THUS
00001ACA                          1657  ; THEY MUST NOT BE IN PROTECTED MEMORY.
00001ACA                          1658  ; NOTE THAT USING DMMDATA IN SUCH WAY IS A BAD IDEA, AS USER APPLICATIONS CAN
00001ACA                          1659  ; ALSO FREE OR CHANGE OWNERSHIP. NONETHELESS, FOR THE SAKE OF THIS EXAMPLE
00001ACA                          1660  ; THIS IS GOOD ENOUGH.
00001ACA                          1661  ; =============================================================================
00001ACA                          1662  
00001ACA                          1663  ; --- KEYBOARD RELATED VARIABLES ----------------------------------------------
00001ACA                          1664  
00001ACA                          1665  KBDVAL      DS.B    1                       ; KEY PRESSED=1
00001ACB                          1666  KBDEDGE     DS.B    1                       ; KEY CHANGED=1
00001ACC                          1667  
00001ACC                          1668              DS.W    0
00001ACC                          1669  
00001ACC                          1670  ; --- SCREEN RELATED VARIABLES ------------------------------------------------
00001ACC                          1671  
00001ACC                          1672  SCRINTCT    DS.B    1                       ; INTERRUPT COUNTER/FLAG
00001ACD                          1673  SCRCYCCT    DS.B    1                       ; CYCLE COUNTER
00001ACE                          1674              DS.W    0
00001ACE                          1675  
00001ACE                          1676  ; --- DYNAMIC MEMORY VARIABLES ------------------------------------------------
00001ACE                          1677  
00001B00                          1678              ORG     (*+DMMBSIZE-1)&-DMMBSIZE ; ALIGN TO DMMBSIZE
00001B00                          1679  DMMDATA     DS.B    DMMBSIZE*DMMBNUM        ; DYNAMIC MEMORY ALLOCATION SPACE
00002780                          1680              DS.W    0                       ; JUST IN CASE (SIZE IS POW OF TWO)
00002780                          1681  
00002780                          1682  
00002780                          1683  -------------------- end include --------------------
00002780                          1684              INCLUDE "VAR.X68"
00002780                          1685  ; =============================================================================
00002780                          1686  ; GAME VARS
00002780                          1687  ; =============================================================================
00002780                          1688  
00002780                          1689  ; TO DO: DECLARE GAME VARIABLES HERE.
00002780                          1690  
00002780                          1691  
00002780                          1692  ; --- GAME STATE RELATED VARIABLES --------------------------------------------
00002780                          1693  
00002780                          1694  
00002780= 00001862                1695  STATES      DC.L    STAINIT                 ;INITIALIZE STATE 0
00002784= 00001872                1696              DC.L    STAMENU                 ;MENU STATE       1
00002788= 0000189A                1697              DC.L    STAGAME                 ;GAME STATE       2
0000278C= 000018B2                1698              DC.L    STAUPD                  ;UPDATE STATE     3
00002790= 000019BA                1699              DC.L    STAPAUS                 ;PAUSED STATE     4 
00002794= 00001A3A                1700              DC.L    STAGOVRU                ;GAME OVER STATE  5
00002798                          1701              
00002798= 0000193A                1702  STATESP     DC.L    STAINTRP                ;INIT PLOT        0
0000279C= 0000190A                1703              DC.L    STAUPDP                 ;UPDATE PLOT      1
000027A0= 000019E4                1704              DC.L    STAPAUSP                ;PAUSE PLOT       2
000027A4= 00001A5E                1705              DC.L    STAGOVRP                ;GAME OVER PLOT   3
000027A8                          1706              
000027A8                          1707  STATE       DS.L    1                       ;CURRENT STATE
000027AC                          1708  STATEP      DS.L    1                       ;CURRENT STATE PLOT
000027B0                          1709  
000027B0                          1710  ; --- PLAYER RELATED VARIABLES ------------------------------------------------
000027B0                          1711  
000027B0                          1712  PLRPOSX     DS.W    1                       ; PLAYER X POSITION (PIXELS)
000027B2                          1713  PLRPOSY     DS.W    1                       ; PLAYER Y POSITION (PIXELS)
000027B4                          1714  PLRENER     DS.W    1                       ; PLAYER ENERGY
000027B6                          1715  PLRSCORE    DS.W    1                       ; PLAYER SCORE
000027B8                          1716  PLRLIFE     DS.W    1                       ; PLAYER IN GAME LIFE
000027BA                          1717  
000027BA                          1718  PLRDMG      DS.B    1                       ; BIT0: UPD DAMAGE, BIT1 PLOT DMG
000027BC                          1719              DS.W    0
000027BC                          1720  
000027BC                          1721  ; --- BOMBMAN RELATED VARIABLES ------------------------------------------------
000027BC                          1722  
000027BC                          1723  BMNPOSX     DS.W    1                       ; BOMBMAN X POSITION  (PIXELS) 
000027BE                          1724  BMNPOSY     DS.W    1                       ; BOMBMAN Y POSITION  (PIXELS)
000027C0                          1725  BMNDIR      DS.W    1                       ; BOMBMAN DIRECTION 
000027C2                          1726                                              ; RIGHT > #128  LEFT < #128 
000027C2                          1727  
000027C2                          1728  ; --- UTILITY VARIABLES ------------------------------------------------------
000027C2                          1729  
000027C2                          1730  UTLRNDIX    DS.B    1                       ; NEXT INDEX TO RANDOM NUMBER
000027C4                          1731              DS.W    0
000027C4                          1732  
000027C4                          1733  
000027C4                          1734  
000027C4                          1735  
000027C4                          1736  
000027C4                          1737  
000027C4                          1738  
000027C4                          1739  
000027C4                          1740  
000027C4                          1741  
000027C4                          1742  
000027C4                          1743  
000027C4                          1744  
000027C4                          1745  
000027C4                          1746  
000027C4                          1747  
000027C4                          1748  
000027C4                          1749  -------------------- end include --------------------
000027C4                          1750              END    START

No errors detected
No warnings generated


SYMBOL TABLE INFORMATION
Symbol-name         Value
-------------------------
AGLADD              15FA
AGLADD:END          1610
AGLKILL             1222
AGLPLOT             1638
AGLPLOT:END         1658
AGLPLOT:LOOP        1640
AGLUPD              1614
AGLUPD:END          1632
AGLUPD:LOOP         161C
ASTTYPE             2
BMNDIR              27C0
BMNHEIGH            1E
BMNINIT             1532
BMNNRMCL            51AE00
BMNPLOT             15C2
BMNPOSX             27BC
BMNPOSY             27BE
BMNSPEED            9
BMNUPD              154C
BMNUPD:CHKRT        15A4
BMNUPD:END          15C0
BMNUPD:ENDCICLE     157C
BMNWIDTH            1E
BOMBDMG             1
BOMBFILCL           FF00
BOMBFRAG            5
BOMBINIT            165E
BOMBPENCL           FFFFFF
BOMBPLOT            1716
BOMBSCORE           5
BOMBSIZE            14
BOMBUPD             1688
BOMBUPD:CATCH       1702
BOMBUPD:COLPLAY     169A
BOMBUPD:DMG         16E4
BOMBUPD:END         16D8
BOMBUPD:KILL        16DE
BOMBXPLO            1750
BOMBXPLO:LOOP       1758
DMMALLOC            1208
DMMALLOC:END        1220
DMMBNUM             32
DMMBSIZE            40
DMMDATA             1B00
DMMFCOM             11E2
DMMFFND             11F0
DMMFIRST            1198
DMMFLOOP            11D6
DMMFRCOM            11AA
DMMFREE             1222
DMMFRFND            11B8
DMMFRLOP            119E
DMMFRSTO            11D0
DMMINIT             1176
DMMINIT:LOOP        1184
DMMNEXT             11BA
DMMNEXTO            11F2
DMMSYSID            0
GOVSTRC             FFFFFF
GOVSTRX             23
GOVSTRY             F
INTPRSC             FFFFFF
INTPRSX             1F
INTPRSY             1A
INTTITC             FF
INTTITX             1F
INTTITY             5
KBDBITDN            3
KBDBITF1            4
KBDBITF2            5
KBDBITF3            6
KBDBITLF            0
KBDBITPS            7
KBDBITRT            2
KBDBITUP            1
KBDCHRDN            28
KBDCHRLF            25
KBDCHRMK            4D
KBDCHRPK            50
KBDCHRRT            27
KBDCHRSH            10
KBDCHRSP            20
KBDCHRUP            26
KBDDOWN             28
KBDEDGE             1ACB
KBDFIRE1            20
KBDFIRE2            4D
KBDFIRE3            10
KBDINIT             10A6
KBDLEFT             25
KBDMSKDN            8
KBDMSKF1            10
KBDMSKF2            20
KBDMSKF3            40
KBDMSKLF            1
KBDMSKPS            80
KBDMSKRT            4
KBDMSKUP            2
KBDPAUSE            50
KBDREAD             10BC
KBDREAD:DOWN        1112
KBDREAD:FIN         1162
KBDREAD:FIRE1       1122
KBDREAD:FIRE2       1132
KBDREAD:FIRE3       1142
KBDREAD:PAUSE       1152
KBDREAD:RIGHT       1102
KBDREAD:UP          10F2
KBDRIGHT            27
KBDTRAP             0
KBDUP               26
KBDVAL              1ACA
PAUSTITX            19
PAUSTITY            F
PLRCLIFE            3
PLRDMG              27BA
PLRDMGCL            FF
PLRENER             27B4
PLRHEIGH            28
PLRINIEN            1F4
PLRINIT             1392
PLRLIFE             27B8
PLRLIFEC            FF
PLRLIFEH            14
PLRLIFEY            1B8
PLRNRMCL            C0FF
PLRPBDMG            1
PLRPLOT             13FE
PLRPLOT:HEART       1484
PLRPLOT:NODMG       141A
PLRPLOT:SCORESTR    152A
PLRPMDMG            2
PLRPOSX             27B0
PLRPOSY             27B2
PLRSCORE            27B6
PLRSPEED            A
PLRTXTCL            FFFFFF
PLRTXTX             2
PLRTXTY             1
PLRUBDMG            0
PLRUMDMG            1
PLRUPD              13B2
PLRUPD:CHKRT        13D8
PLRUPD:NODMG        13B2
PLRUPD:NOFIRE       13FA
PLRWIDTH            64
SCRCYCCT            1ACD
SCRHEIGH            1E0
SCRINIT             101C
SCRINTCT            1ACC
SCRIRQ              1
SCRISR              107E
SCRTIM              14
SCRTRAP             1
SCRUPD              108C
SCRWIDTH            280
SHTHEIGH            3
SHTSPEED            A
SHTTYPE             1
SHTWIDTH            14
SPWUPD              178E
SPWUPD:END          17B4
STAGAME             189A
STAGOVR             2
STAGOVRP            1A5E
STAGOVRP:GOVSTR     1A92
STAGOVRU            1A3A
STAGOVRU:END        1A5C
STAINIT             1862
STAINTR             0
STAINTRP            193A
STAINTRP:PRSSTR     19A6
STAINTRP:TITSTR     1998
STAMENU             1872
STAMENU:END         1898
STANONE             FFFFFFFF
STAPAUS             19BA
STAPAUS:NEXT        19E2
STAPAUSP            19E4
STAPAUSP:NEXT       1A1A
STAPAUSP:PAUSSTR    1A1C
STAPLAY             1
STAPLOT             1930
START               1A9E
START:LOOP          1AA6
START:WINT          1AB0
STATE               27A8
STATEP              27AC
STATES              2780
STATESP             2798
STAUPD              18B2
STAUPD:FIN          1908
STAUPD:NEXT         18F8
STAUPD:NOTOVER      18DE
STAUPDP             190A
STAUPDP:END         192E
STAUPDP:NOTOVER     1922
SYSINIT             1000
UTLCHCOL            1240
UTLCHCOL:END        126E
UTLCHCOL:NOCOL      126C
UTLINIT             1238
UTLLOCT             254
UTLRAND             1274
UTLRAND:RANDVEC     1292
UTLRNDIX            27C2
UTLSFIL             12A
UTLSND              37C
UTLSPEN             0
XPLFILCL            CCCCCC
XPLINIT             17BA
XPLPENCL            DDDDDD
XPLPLOT             1828
XPLSIZE             14
XPLTYPE             3
XPLUPD              17EA
XPLUPD:END          181E
XPLUPD:KILL         1822
